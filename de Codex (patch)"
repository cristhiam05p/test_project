[1mdiff --git a/codex.patch b/codex.patch[m
[1mindex 0e3d1a5..1172375 100644[m
[1m--- a/codex.patch[m
[1m+++ b/codex.patch[m
[36m@@ -1,856 +1,1247 @@[m
[31m-diff --git a/.gitignore b/.gitignore[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..a5926d87e493ec417af03b7e2bece60e4a8f726d[m
[31m---- /dev/null[m
[31m-+++ b/.gitignore[m
[31m-@@ -0,0 +1,6 @@[m
[31m-+node_modules/[m
[31m-+dist/[m
[31m-+.env[m
[31m-+.env.*[m
[31m-+!.env.example[m
[31m-+.DS_Store[m
[31m-diff --git a/README.md b/README.md[m
[31m-index 8ae9f5d160ebef10750c24df8f5793cf18d98ac9..a9d37c49d0db5c9f8e5defa33d1ffa3be496a67e 100644[m
[31m---- a/README.md[m
[31m-+++ b/README.md[m
[31m-@@ -1,42 +1,97 @@[m
[31m- # Resource Timeline MVP[m
[31m- [m
[31m- MVP para visualizar paquetes de trabajo por **departamento** y **empleado** en una l√≠nea de tiempo (4 semanas, d√≠a a d√≠a).[m
[31m- [m
[31m- ## Stack[m
[31m- [m
[31m- - React + Vite + TypeScript[m
[31m--- Sin backend (mock data local)[m
[31m-+- API serverless en `api/` (compatible con Vercel Functions)[m
[31m-+- Datos seed/fixtures en memoria (para demo del MVP)[m
[31m- [m
[31m- ## Funcionalidades incluidas[m
[31m- [m
[31m- - Vista principal "Recursos" con:[m
[31m-   - Eje vertical: Departamentos -> empleados.[m
[31m-   - Eje horizontal: 28 d√≠as (4 semanas) desde una fecha de demo.[m
[31m- - Bloques de tareas por empleado usando:[m
[31m-   - `scheduledStartDate` como inicio visual.[m
[31m-   - `durationDays` para ancho del bloque.[m
[31m- - Modal de detalle al seleccionar una tarea con:[m
[31m-   - t√≠tulo, descripci√≥n, proyecto, fechas y dependencias.[m
[31m-   - `deadlineDate` destacado visualmente.[m
[31m- - Filtros m√≠nimos:[m
[31m-   - por departamento.[m
[31m-   - por nombre de empleado (buscador).[m
[31m- [m
[31m-+## API MVP ‚ÄúVista Recursos‚Äù (Paso 1 + Paso 2)[m
[31m-+[m
[31m-+Se implement√≥ el modelo de datos normalizado + CRUD m√≠nimo con validaciones en rutas `api/`:[m
[31m-+[m
[31m-+- `/api/departments`[m
[31m-+- `/api/employees`[m
[31m-+- `/api/projects`[m
[31m-+- `/api/tasks`[m
[31m-+- `/api/task-assignments`[m
[31m-+- `/api/time-off`[m
[31m-+[m
[31m-+Cada colecci√≥n soporta:[m
[31m-+[m
[31m-+- `GET /api/<resource>`[m
[31m-+- `POST /api/<resource>`[m
[31m-+- `GET /api/<resource>/:id`[m
[31m-+- `PATCH /api/<resource>/:id`[m
[31m-+- `DELETE /api/<resource>/:id`[m
[31m-+[m
[31m-+### Reglas de validaci√≥n implementadas[m
[31m-+[m
[31m-+- `endDate >= startDate` para Task y TimeOff.[m
[31m-+- `Department.name` √∫nico.[m
[31m-+- `Project.name` √∫nico.[m
[31m-+- FKs v√°lidas en Employee, Task, TaskAssignment y TimeOff.[m
[31m-+- `allocationHours >= 0`, `estimatedHours >= 0`.[m
[31m-+- `status` y `type` restringidos a enums v√°lidos.[m
[31m-+- `TaskAssignment (taskId, employeeId)` √∫nico.[m
[31m-+- Soft delete en Department/Employee/Project (`isActive=false`).[m
[31m-+- `Task DELETE` devuelve `409` si tiene asignaciones relacionadas.[m
[31m-+[m
[31m-+### POSTERGADO (no Vercel-only)[m
[31m-+[m
[31m-+- Persistencia relacional real con Postgres/ORM y migraciones autom√°ticas de deploy (`prisma migrate deploy`).[m
[31m-+- Estado actual de esta iteraci√≥n: se usa almacenamiento en memoria para demo y validaci√≥n funcional del flujo CRUD en serverless.[m
[31m-+[m
[31m-+## Variables de entorno[m
[31m-+[m
[31m-+No son obligatorias para esta iteraci√≥n (almacenamiento en memoria).[m
[31m-+[m
[31m-+Para un siguiente paso con persistencia en Vercel se recomienda:[m
[31m-+[m
[31m-+- `DATABASE_URL` (Vercel Postgres / Neon / Supabase)[m
[31m-+[m
[31m- ## Estructura principal[m
[31m- [m
[31m- ```txt[m
[31m- src/[m
[31m-   components/[m
[31m-     ResourceTimeline.tsx[m
[31m-     DepartmentSection.tsx[m
[31m-     EmployeeRow.tsx[m
[31m-     TaskBlock.tsx[m
[31m-     TaskDetailsModal.tsx[m
[31m-   data/[m
[31m-     mock-data.ts[m
[31m-   types/[m
[31m-     workPackage.ts[m
[31m-   utils/[m
[31m-     dateUtils.ts[m
[31m-     timelineUtils.ts[m
[31m-+api/[m
[31m-+  departments/[m
[31m-+  employees/[m
[31m-+  projects/[m
[31m-+  tasks/[m
[31m-+  task-assignments/[m
[31m-+  time-off/[m
[31m-+lib/[m
[31m-+  api.js[m
[31m-+  store.js[m
[31m- ```[m
[31m-diff --git a/api/departments/[id].js b/api/departments/[id].js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..a80f281471d591679ed05d70838c1938fe6348bd[m
[31m---- /dev/null[m
[31m-+++ b/api/departments/[id].js[m
[31m-@@ -0,0 +1,49 @@[m
[31m-+import { getStore } from '../../lib/store.js';[m
[31m-+import { parseBody, parseId, sendMethodNotAllowed } from '../../lib/api.js';[m
[31m-+[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+  const recordId = parseId(req);[m
[31m-+  const department = store.departments.find((item) => item.id === recordId);[m
[31m-+[m
[31m-+  if (!department) {[m
[31m-+    return res.status(404).json({ error: 'Department not found.' });[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(department);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'PATCH') {[m
[31m-+    const body = parseBody(req);[m
[31m-+    if (!body) return res.status(400).json({ error: 'Invalid body.' });[m
[31m-+[m
[31m-+    if (body.name !== undefined) {[m
[31m-+      if (typeof body.name !== 'string' || !body.name.trim()) {[m
[31m-+        return res.status(400).json({ error: 'name must be a non-empty string.' });[m
[31m-+      }[m
[31m-+[m
[31m-+      const duplicate = store.departments.some([m
[31m-+        (item) => item.id !== recordId && item.name.toLowerCase() === body.name.trim().toLowerCase(),[m
[31m-+      );[m
[31m-+      if (duplicate) {[m
[31m-+        return res.status(409).json({ error: 'Department.name must be unique.' });[m
[31m-+      }[m
[31m-+[m
[31m-+      department.name = body.name.trim();[m
[31m-+    }[m
[31m-+[m
[31m-+    if (typeof body.isActive === 'boolean') {[m
[31m-+      department.isActive = body.isActive;[m
[31m-+    }[m
[31m-+[m
[31m-+    return res.status(200).json(department);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'DELETE') {[m
[31m-+    department.isActive = false;[m
[31m-+    return res.status(200).json(department);[m
[31m-+  }[m
[31m-+[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'PATCH', 'DELETE']);[m
[31m-+}[m
[31m-diff --git a/api/departments/index.js b/api/departments/index.js[m
[32m+[m[32mdiff --git a/src/App.tsx b/src/App.tsx[m
[32m+[m[32mindex e7013ea3228dc34963f6f044333d819160a4fb0e..a7618e70880992a4faa6f7299e86b97064deaef0 100644[m
[32m+[m[32m--- a/src/App.tsx[m
[32m+[m[32m+++ b/src/App.tsx[m
[32m+[m[32m@@ -1,8 +1,15 @@[m
[32m+[m[32m import { ResourceTimeline } from './components/ResourceTimeline';[m
[32m+[m[32m-import { demoStartDate, workPackages } from './data/mock-data';[m
[32m+[m[32m+import { demoStartDate, employeeProfiles, timelineWeeks, workPackages } from './data/mock-data';[m
[32m+[m[41m [m
[32m+[m[32m function App() {[m
[32m+[m[32m-  return <ResourceTimeline tasks={workPackages} timelineStartDate={demoStartDate} />;[m
[32m+[m[32m+  return ([m
[32m+[m[32m+    <ResourceTimeline[m
[32m+[m[32m+      tasks={workPackages}[m
[32m+[m[32m+      employees={employeeProfiles}[m
[32m+[m[32m+      timelineStartDate={demoStartDate}[m
[32m+[m[32m+      timelineDays={timelineWeeks * 7}[m
[32m+[m[32m+    />[m
[32m+[m[32m+  );[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m export default App;[m
[32m+[m[32mdiff --git a/src/components/DepartmentSection.tsx b/src/components/DepartmentSection.tsx[m
[32m+[m[32mindex 0da3e1bb01f0f6b24f95b695f3e6d216f62e4820..2c8b91198fcfd8c3422b9dfa81b4f4d46166ed25 100644[m
[32m+[m[32m--- a/src/components/DepartmentSection.tsx[m
[32m+[m[32m+++ b/src/components/DepartmentSection.tsx[m
[32m+[m[32m@@ -1,38 +1,47 @@[m
[32m+[m[32m-import type { WorkPackage } from '../types/workPackage';[m
[32m+[m[32m-import type { EmployeeGroup } from '../utils/timelineUtils';[m
[32m+[m[32m-import { EmployeeRow } from './EmployeeRow';[m
[32m+[m[32m+import type { WorkPackage } from "../types/workPackage";[m
[32m+[m[32m+import type { EmployeeGroup } from "../utils/timelineUtils";[m
[32m+[m[32m+import { EmployeeRow } from "./EmployeeRow";[m
[32m+[m[41m [m
[32m+[m[32m interface DepartmentSectionProps {[m
[32m+[m[32m   department: string;[m
[32m+[m[32m   employees: EmployeeGroup[];[m
[32m+[m[32m   timelineStartDate: string;[m
[32m+[m[32m   timelineDays: number;[m
[32m+[m[32m-  dayWidth: number;[m
[32m+[m[32m+  dayWidths: number[];[m
[32m+[m[32m+  cumulativeOffsets: number[];[m
[32m+[m[32m+  totalTimelineWidth: number;[m
[32m+[m[32m   onTaskSelect: (task: WorkPackage) => void;[m
[32m+[m[32m+  onEmployeeSelect: (employeeId: string) => void;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m export const DepartmentSection = ({[m
[32m+[m[32m   department,[m
[32m+[m[32m   employees,[m
[32m+[m[32m   timelineStartDate,[m
[32m+[m[32m   timelineDays,[m
[32m+[m[32m-  dayWidth,[m
[32m+[m[32m+  dayWidths,[m
[32m+[m[32m+  cumulativeOffsets,[m
[32m+[m[32m+  totalTimelineWidth,[m
[32m+[m[32m   onTaskSelect,[m
[32m+[m[32m+  onEmployeeSelect,[m
[32m+[m[32m }: DepartmentSectionProps) => {[m
[32m+[m[32m   return ([m
[32m+[m[32m     <section className="department-section">[m
[32m+[m[32m       <h2>{department}</h2>[m
[32m+[m[32m       {employees.map((employee) => ([m
[32m+[m[32m         <EmployeeRow[m
[32m+[m[32m           key={employee.employeeId}[m
[32m+[m[32m           employeeName={employee.employeeName}[m
[32m+[m[32m           tasks={employee.tasks}[m
[32m+[m[32m           timelineStartDate={timelineStartDate}[m
[32m+[m[32m           timelineDays={timelineDays}[m
[32m+[m[32m-          dayWidth={dayWidth}[m
[32m+[m[32m+          dayWidths={dayWidths}[m
[32m+[m[32m+          cumulativeOffsets={cumulativeOffsets}[m
[32m+[m[32m+          totalTimelineWidth={totalTimelineWidth}[m
[32m+[m[32m           onTaskSelect={onTaskSelect}[m
[32m+[m[32m+          onEmployeeSelect={() => onEmployeeSelect(employee.employeeId)}[m
[32m+[m[32m         />[m
[32m+[m[32m       ))}[m
[32m+[m[32m     </section>[m
[32m+[m[32m   );[m
[32m+[m[32m };[m
[32m+[m[32mdiff --git a/src/components/EmployeeDetailsModal.tsx b/src/components/EmployeeDetailsModal.tsx[m
 new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..6782d1a3c84d6c2a12f1cbfdf08c59a4fffaaa69[m
[32m+[m[32mindex 0000000000000000000000000000000000000000..0ca5bbeb18710efd6fb9edb2e8e42599a94ffebb[m
 --- /dev/null[m
[31m-+++ b/api/departments/index.js[m
[31m-@@ -0,0 +1,28 @@[m
[31m-+import { getStore, id } from '../../lib/store.js';[m
[31m-+import { parseBody, sendMethodNotAllowed } from '../../lib/api.js';[m
[31m-+[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(store.departments);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'POST') {[m
[31m-+    const body = parseBody(req);[m
[31m-+    if (!body || typeof body.name !== 'string' || !body.name.trim()) {[m
[31m-+      return res.status(400).json({ error: 'name is required.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    const name = body.name.trim();[m
[31m-+    if (store.departments.some((department) => department.name.toLowerCase() === name.toLowerCase())) {[m
[31m-+      return res.status(409).json({ error: 'Department.name must be unique.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    const department = { id: id('dep', store), name, isActive: true };[m
[31m-+    store.departments.push(department);[m
[31m-+    return res.status(201).json(department);[m
[31m-+  }[m
[31m-+[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'POST']);[m
[32m+[m[32m+++ b/src/components/EmployeeDetailsModal.tsx[m
[32m+[m[32m@@ -0,0 +1,156 @@[m
[32m+[m[32m+import { useEffect, useMemo } from "react";[m
[32m+[m[32m+import { createPortal } from "react-dom";[m
[32m+[m[32m+import type { EmployeeProfile } from "../data/mock-data";[m
[32m+[m[32m+import type { WorkPackage } from "../types/workPackage";[m
[32m+[m[32m+import { addDays, differenceInDays, formatISODate, getISOWeek, toDate } from "../utils/dateUtils";[m
[32m+[m[32m+[m
[32m+[m[32m+interface EmployeeDetailsModalProps {[m
[32m+[m[32m+  employee: EmployeeProfile | null;[m
[32m+[m[32m+  tasks: WorkPackage[];[m
[32m+[m[32m+  timelineStartDate: string;[m
[32m+[m[32m+  timelineDays: number;[m
[32m+[m[32m+  onClose: () => void;[m
 +}[m
[31m-diff --git a/api/employees/[id].js b/api/employees/[id].js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..ae73711b24ac704a49992988f5bb53de18780a89[m
[31m---- /dev/null[m
[31m-+++ b/api/employees/[id].js[m
[31m-@@ -0,0 +1,49 @@[m
[31m-+import { getStore } from '../../lib/store.js';[m
[31m-+import { isNonNegativeNumber, parseBody, parseId, sendMethodNotAllowed } from '../../lib/api.js';[m
 +[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+  const employee = store.employees.find((item) => item.id === parseId(req));[m
[32m+[m[32m+const getVisibleHours = (tasks: WorkPackage[], startDate: string, timelineDays: number) => {[m
[32m+[m[32m+  const visibleStart = toDate(startDate);[m
[32m+[m[32m+  const visibleEnd = addDays(visibleStart, timelineDays - 1);[m
 +[m
[31m-+  if (!employee) {[m
[31m-+    return res.status(404).json({ error: 'Employee not found.' });[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(employee);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'PATCH') {[m
[31m-+    const body = parseBody(req);[m
[31m-+    if (!body) return res.status(400).json({ error: 'Invalid body.' });[m
[31m-+[m
[31m-+    if (body.departmentId !== undefined && !store.departments.some((department) => department.id === body.departmentId)) {[m
[31m-+      return res.status(400).json({ error: 'Employee.departmentId must exist.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (body.capacityHoursPerWeek !== undefined && !isNonNegativeNumber(body.capacityHoursPerWeek)) {[m
[31m-+      return res.status(400).json({ error: 'capacityHoursPerWeek must be >= 0.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (body.costPerHour !== undefined && !isNonNegativeNumber(body.costPerHour)) {[m
[31m-+      return res.status(400).json({ error: 'costPerHour must be >= 0.' });[m
[32m+[m[32m+  return tasks.reduce((total, task) => {[m
[32m+[m[32m+    const taskStart = toDate(task.scheduledStartDate);[m
[32m+[m[32m+    const taskEnd = addDays(taskStart, task.durationDays - 1);[m
[32m+[m[32m+    if (taskEnd < visibleStart || taskStart > visibleEnd) {[m
[32m+[m[32m+      return total;[m
 +    }[m
[31m-+[m
[31m-+    Object.assign(employee, {[m
[31m-+      ...(body.fullName !== undefined ? { fullName: body.fullName.trim() } : {}),[m
[31m-+      ...(body.departmentId !== undefined ? { departmentId: body.departmentId } : {}),[m
[31m-+      ...(body.capacityHoursPerWeek !== undefined ? { capacityHoursPerWeek: body.capacityHoursPerWeek } : {}),[m
[31m-+      ...(body.costPerHour !== undefined ? { costPerHour: body.costPerHour } : {}),[m
[31m-+      ...(typeof body.isActive === 'boolean' ? { isActive: body.isActive } : {}),[m
[32m+[m[32m+    const overlapStart = taskStart < visibleStart ? visibleStart : taskStart;[m
[32m+[m[32m+    const overlapEnd = taskEnd > visibleEnd ? visibleEnd : taskEnd;[m
[32m+[m[32m+    const overlapDays = differenceInDays(overlapStart, overlapEnd) + 1;[m
[32m+[m[32m+    return total + overlapDays * 8;[m
[32m+[m[32m+  }, 0);[m
[32m+[m[32m+};[m
[32m+[m[32m+[m
[32m+[m[32m+const getOverloadedWeeks = (tasks: WorkPackage[], weeklyCapacityHours: number) => {[m
[32m+[m[32m+  const weekHours = new Map<string, number>();[m
[32m+[m[32m+[m
[32m+[m[32m+  tasks.forEach((task) => {[m
[32m+[m[32m+    const taskStart = toDate(task.scheduledStartDate);[m
[32m+[m[32m+    Array.from({ length: task.durationDays }, (_, dayOffset) => addDays(taskStart, dayOffset)).forEach((day) => {[m
[32m+[m[32m+      const key = `${day.getFullYear()}-${getISOWeek(day)}`;[m
[32m+[m[32m+      weekHours.set(key, (weekHours.get(key) ?? 0) + 8);[m
 +    });[m
[31m-+[m
[31m-+    return res.status(200).json(employee);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'DELETE') {[m
[31m-+    employee.isActive = false;[m
[31m-+    return res.status(200).json(employee);[m
[31m-+  }[m
[31m-+[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'PATCH', 'DELETE']);[m
[31m-+}[m
[31m-diff --git a/api/employees/index.js b/api/employees/index.js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..bd81e31fb2f262c25d9a65b0065328cef647ed3e[m
[31m---- /dev/null[m
[31m-+++ b/api/employees/index.js[m
[31m-@@ -0,0 +1,43 @@[m
[31m-+import { getStore, id } from '../../lib/store.js';[m
[31m-+import { isNonNegativeNumber, parseBody, sendMethodNotAllowed } from '../../lib/api.js';[m
[31m-+[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(store.employees);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'POST') {[m
[31m-+    const body = parseBody(req);[m
[31m-+    if (!body || typeof body.fullName !== 'string' || !body.fullName.trim() || typeof body.departmentId !== 'string') {[m
[31m-+      return res.status(400).json({ error: 'fullName and departmentId are required.' });[m
[32m+[m[32m+  });[m
[32m+[m[32m+[m
[32m+[m[32m+  return [...weekHours.entries()][m
[32m+[m[32m+    .filter(([, hours]) => hours > weeklyCapacityHours)[m
[32m+[m[32m+    .map(([weekKey, hours]) => ({ weekKey, hours }));[m
[32m+[m[32m+};[m
[32m+[m[32m+[m
[32m+[m[32m+export const EmployeeDetailsModal = ({[m
[32m+[m[32m+  employee,[m
[32m+[m[32m+  tasks,[m
[32m+[m[32m+  timelineStartDate,[m
[32m+[m[32m+  timelineDays,[m
[32m+[m[32m+  onClose,[m
[32m+[m[32m+}: EmployeeDetailsModalProps) => {[m
[32m+[m[32m+  const visibleHours = useMemo(() => {[m
[32m+[m[32m+    if (!employee) {[m
[32m+[m[32m+      return 0;[m
 +    }[m
[32m+[m[32m+    return getVisibleHours(tasks, timelineStartDate, timelineDays);[m
[32m+[m[32m+  }, [employee, tasks, timelineStartDate, timelineDays]);[m
 +[m
[31m-+    if (!store.departments.some((department) => department.id === body.departmentId)) {[m
[31m-+      return res.status(400).json({ error: 'Employee.departmentId must exist.' });[m
[32m+[m[32m+  const overloadedWeeks = useMemo(() => {[m
[32m+[m[32m+    if (!employee) {[m
[32m+[m[32m+      return [];[m
 +    }[m
[32m+[m[32m+    return getOverloadedWeeks(tasks, employee.weeklyCapacityHours);[m
[32m+[m[32m+  }, [employee, tasks]);[m
 +[m
[31m-+    if (body.capacityHoursPerWeek !== undefined && !isNonNegativeNumber(body.capacityHoursPerWeek)) {[m
[31m-+      return res.status(400).json({ error: 'capacityHoursPerWeek must be >= 0.' });[m
[32m+[m[32m+  useEffect(() => {[m
[32m+[m[32m+    if (!employee) {[m
[32m+[m[32m+      return;[m
 +    }[m
 +[m
[31m-+    if (body.costPerHour !== undefined && !isNonNegativeNumber(body.costPerHour)) {[m
[31m-+      return res.status(400).json({ error: 'costPerHour must be >= 0.' });[m
[31m-+    }[m
[32m+[m[32m+    const previousOverflow = document.body.style.overflow;[m
[32m+[m[32m+    document.body.style.overflow = "hidden";[m
 +[m
[31m-+    const employee = {[m
[31m-+      id: id('emp', store),[m
[31m-+      fullName: body.fullName.trim(),[m
[31m-+      departmentId: body.departmentId,[m
[31m-+      capacityHoursPerWeek: body.capacityHoursPerWeek ?? 40,[m
[31m-+      costPerHour: body.costPerHour ?? null,[m
[31m-+      isActive: true,[m
[32m+[m[32m+    const onKeyDown = (event: KeyboardEvent) => {[m
[32m+[m[32m+      if (event.key === "Escape") {[m
[32m+[m[32m+        onClose();[m
[32m+[m[32m+      }[m
 +    };[m
 +[m
[31m-+    store.employees.push(employee);[m
[31m-+    return res.status(201).json(employee);[m
[31m-+  }[m
[31m-+[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'POST']);[m
[31m-+}[m
[31m-diff --git a/api/projects/[id].js b/api/projects/[id].js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..617ea0dcf3a9611414a058e60308d625058f2bfa[m
[31m---- /dev/null[m
[31m-+++ b/api/projects/[id].js[m
[31m-@@ -0,0 +1,51 @@[m
[31m-+import { getStore } from '../../lib/store.js';[m
[31m-+import { parseBody, parseId, sendMethodNotAllowed } from '../../lib/api.js';[m
[31m-+[m
[31m-+const hexColorRegex = /^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/;[m
[31m-+[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+  const project = store.projects.find((item) => item.id === parseId(req));[m
[31m-+[m
[31m-+  if (!project) {[m
[31m-+    return res.status(404).json({ error: 'Project not found.' });[m
[31m-+  }[m
[32m+[m[32m+    window.addEventListener("keydown", onKeyDown);[m
[32m+[m[32m+    return () => {[m
[32m+[m[32m+      document.body.style.overflow = previousOverflow;[m
[32m+[m[32m+      window.removeEventListener("keydown", onKeyDown);[m
[32m+[m[32m+    };[m
[32m+[m[32m+  }, [employee, onClose]);[m
 +[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(project);[m
[32m+[m[32m+  if (!employee) {[m
[32m+[m[32m+    return null;[m
 +  }[m
 +[m
[31m-+  if (req.method === 'PATCH') {[m
[31m-+    const body = parseBody(req);[m
[31m-+    if (!body) return res.status(400).json({ error: 'Invalid body.' });[m
[31m-+[m
[31m-+    if (body.name !== undefined) {[m
[31m-+      if (typeof body.name !== 'string' || !body.name.trim()) {[m
[31m-+        return res.status(400).json({ error: 'name must be a non-empty string.' });[m
[31m-+      }[m
[31m-+      const duplicate = store.projects.some((item) => item.id !== project.id && item.name.toLowerCase() === body.name.trim().toLowerCase());[m
[31m-+      if (duplicate) {[m
[31m-+        return res.status(409).json({ error: 'Project.name must be unique.' });[m
[31m-+      }[m
[31m-+      project.name = body.name.trim();[m
[31m-+    }[m
[31m-+[m
[31m-+    if (body.color !== undefined && (typeof body.color !== 'string' || !hexColorRegex.test(body.color))) {[m
[31m-+      return res.status(400).json({ error: 'color must be a valid hex code.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    Object.assign(project, {[m
[31m-+      ...(body.color !== undefined ? { color: body.color } : {}),[m
[31m-+      ...(typeof body.isActive === 'boolean' ? { isActive: body.isActive } : {}),[m
[32m+[m[32m+  return createPortal([m
[32m+[m[32m+    <div className="modal-overlay" onClick={onClose} role="presentation">[m
[32m+[m[32m+      <aside className="modal-panel" onClick={(event) => event.stopPropagation()}>[m
[32m+[m[32m+        <button className="close-button" onClick={onClose} type="button" aria-label="Cerrar detalles de empleado">[m
[32m+[m[32m+          ‚úï[m
[32m+[m[32m+        </button>[m
[32m+[m[32m+[m
[32m+[m[32m+        <h3>{employee.employeeName}</h3>[m
[32m+[m[32m+[m
[32m+[m[32m+        <dl>[m
[32m+[m[32m+          <dt>Departamento</dt>[m
[32m+[m[32m+          <dd>{employee.department}</dd>[m
[32m+[m[32m+[m
[32m+[m[32m+          <dt>Rol</dt>[m
[32m+[m[32m+          <dd>{employee.role}</dd>[m
[32m+[m[32m+[m
[32m+[m[32m+          <dt>Coste/hora</dt>[m
[32m+[m[32m+          <dd>‚Ç¨{employee.hourlyCost}</dd>[m
[32m+[m[32m+[m
[32m+[m[32m+          <dt>Horas/semana</dt>[m
[32m+[m[32m+          <dd>{employee.weeklyCapacityHours} h</dd>[m
[32m+[m[32m+[m
[32m+[m[32m+          <dt>Ausencias</dt>[m
[32m+[m[32m+          <dd>[m
[32m+[m[32m+            {employee.absences.length === 0[m
[32m+[m[32m+              ? "Sin ausencias registradas"[m
[32m+[m[32m+              : employee.absences.map((absence) => ([m
[32m+[m[32m+                  <div key={`${absence.startDate}-${absence.reason}`}>[m
[32m+[m[32m+                    {absence.reason}: {absence.startDate} ‚Üí {absence.endDate}[m
[32m+[m[32m+                  </div>[m
[32m+[m[32m+                ))}[m
[32m+[m[32m+          </dd>[m
[32m+[m[32m+[m
[32m+[m[32m+          <dt>Horas asignadas (ventana visible)</dt>[m
[32m+[m[32m+          <dd>{visibleHours} h</dd>[m
[32m+[m[32m+[m
[32m+[m[32m+          <dt>Semanas con sobrecarga</dt>[m
[32m+[m[32m+          <dd>[m
[32m+[m[32m+            {overloadedWeeks.length === 0[m
[32m+[m[32m+              ? "Sin sobrecarga"[m
[32m+[m[32m+              : overloadedWeeks.map((entry) => ([m
[32m+[m[32m+                  <div key={entry.weekKey}>[m
[32m+[m[32m+                    {entry.weekKey} ({entry.hours} h)[m
[32m+[m[32m+                  </div>[m
[32m+[m[32m+                ))}[m
[32m+[m[32m+          </dd>[m
[32m+[m[32m+        </dl>[m
[32m+[m[32m+[m
[32m+[m[32m+        <h4>Tareas asignadas</h4>[m
[32m+[m[32m+        <ul>[m
[32m+[m[32m+          {tasks.map((task) => ([m
[32m+[m[32m+            <li key={task.id}>[m
[32m+[m[32m+              <strong>{task.title}</strong> ‚Äî {task.projectName} ({task.scheduledStartDate} ‚Üí {formatISODate(addDays(toDate(task.scheduledStartDate), task.durationDays - 1))})[m
[32m+[m[32m+              <br />[m
[32m+[m[32m+              <small>{task.description}</small>[m
[32m+[m[32m+            </li>[m
[32m+[m[32m+          ))}[m
[32m+[m[32m+        </ul>[m
[32m+[m[32m+      </aside>[m
[32m+[m[32m+    </div>,[m
[32m+[m[32m+    document.body,[m
[32m+[m[32m+  );[m
[32m+[m[32m+};[m
[32m+[m[32mdiff --git a/src/components/EmployeeRow.tsx b/src/components/EmployeeRow.tsx[m
[32m+[m[32mindex 440845f10f9707a12300d6bb3219bce5f0e80e86..a566fd1803fb3f8fea7a290a3958d21c8a0ca797 100644[m
[32m+[m[32m--- a/src/components/EmployeeRow.tsx[m
[32m+[m[32m+++ b/src/components/EmployeeRow.tsx[m
[32m+[m[32m@@ -1,40 +1,54 @@[m
[32m+[m[32m-import type { WorkPackage } from '../types/workPackage';[m
[32m+[m[32m-import { TaskBlock } from './TaskBlock';[m
[32m+[m[32m+import type { WorkPackage } from "../types/workPackage";[m
[32m+[m[32m+import { TaskBlock } from "./TaskBlock";[m
[32m+[m[41m [m
[32m+[m[32m interface EmployeeRowProps {[m
[32m+[m[32m   employeeName: string;[m
[32m+[m[32m   tasks: WorkPackage[];[m
[32m+[m[32m   timelineStartDate: string;[m
[32m+[m[32m   timelineDays: number;[m
[32m+[m[32m-  dayWidth: number;[m
[32m+[m[32m+  dayWidths: number[];[m
[32m+[m[32m+  cumulativeOffsets: number[];[m
[32m+[m[32m+  totalTimelineWidth: number;[m
[32m+[m[32m   onTaskSelect: (task: WorkPackage) => void;[m
[32m+[m[32m+  onEmployeeSelect: () => void;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m export const EmployeeRow = ({[m
[32m+[m[32m   employeeName,[m
[32m+[m[32m   tasks,[m
[32m+[m[32m   timelineStartDate,[m
[32m+[m[32m   timelineDays,[m
[32m+[m[32m-  dayWidth,[m
[32m+[m[32m+  dayWidths,[m
[32m+[m[32m+  cumulativeOffsets,[m
[32m+[m[32m+  totalTimelineWidth,[m
[32m+[m[32m   onTaskSelect,[m
[32m+[m[32m+  onEmployeeSelect,[m
[32m+[m[32m }: EmployeeRowProps) => {[m
[32m+[m[32m   return ([m
[32m+[m[32m     <div className="employee-row">[m
[32m+[m[32m-      <div className="employee-label">{employeeName}</div>[m
[32m+[m[32m-      <div className="employee-timeline" style={{ width: dayWidth * timelineDays }}>[m
[32m+[m[32m+      <button className="employee-label employee-button" onClick={onEmployeeSelect} type="button">[m
[32m+[m[32m+        {employeeName}[m
[32m+[m[32m+      </button>[m
[32m+[m[32m+      <div className="employee-timeline" style={{ width: totalTimelineWidth }}>[m
[32m+[m[32m         {Array.from({ length: timelineDays }, (_, index) => ([m
[32m+[m[32m-          <div key={index} className="day-cell" style={{ width: dayWidth }} />[m
[32m+[m[32m+          <div[m
[32m+[m[32m+            key={index}[m
[32m+[m[32m+            className="day-cell"[m
[32m+[m[32m+            style={{ width: dayWidths[index], left: cumulativeOffsets[index] }}[m
[32m+[m[32m+          />[m
[32m+[m[32m         ))}[m
[32m+[m[32m         {tasks.map((task) => ([m
[32m+[m[32m           <TaskBlock[m
[32m+[m[32m             key={task.id}[m
[32m+[m[32m             task={task}[m
[32m+[m[32m             timelineStartDate={timelineStartDate}[m
[32m+[m[32m-            dayWidth={dayWidth}[m
[32m+[m[32m+            dayWidth={dayWidths[0]}[m
[32m+[m[32m+            dayWidths={dayWidths}[m
[32m+[m[32m+            cumulativeOffsets={cumulativeOffsets}[m
[32m+[m[32m             onSelect={onTaskSelect}[m
[32m+[m[32m           />[m
[32m+[m[32m         ))}[m
[32m+[m[32m       </div>[m
[32m+[m[32m     </div>[m
[32m+[m[32m   );[m
[32m+[m[32m };[m
[32m+[m[32mdiff --git a/src/components/ResourceTimeline.tsx b/src/components/ResourceTimeline.tsx[m
[32m+[m[32mindex fc8647caba84355f9c9aaa810441054f76385312..0b97b732c82156a968ec6c4d3328c062093b88f4 100644[m
[32m+[m[32m--- a/src/components/ResourceTimeline.tsx[m
[32m+[m[32m+++ b/src/components/ResourceTimeline.tsx[m
[32m+[m[32m@@ -1,116 +1,158 @@[m
[32m+[m[32m import { useMemo, useState } from "react";[m
[32m+[m[32m+import type { EmployeeProfile } from "../data/mock-data";[m
[32m+[m[32m import type { WorkPackage } from "../types/workPackage";[m
[32m+[m[32m import {[m
[32m+[m[32m   formatDayLabel,[m
[32m+[m[32m   formatDayMonth,[m
[32m+[m[32m   getDayRange,[m
[32m+[m[32m   getWeekHeaderGroups,[m
[32m+[m[32m   getWeekLabel,[m
[32m+[m[32m } from "../utils/dateUtils";[m
[32m+[m[32m import { includesNormalized } from "../utils/textUtils";[m
[32m+[m[32m import { groupByDepartmentAndEmployee } from "../utils/timelineUtils";[m
[32m+[m[32m import { DepartmentSection } from "./DepartmentSection";[m
[32m+[m[32m+import { EmployeeDetailsModal } from "./EmployeeDetailsModal";[m
[32m+[m[32m import { TaskDetailsModal } from "./TaskDetailsModal";[m
[32m+[m[41m [m
[32m+[m[32m interface ResourceTimelineProps {[m
[32m+[m[32m   tasks: WorkPackage[];[m
[32m+[m[32m+  employees: EmployeeProfile[];[m
[32m+[m[32m   timelineStartDate: string;[m
[32m+[m[32m   timelineDays?: number;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m const DAY_WIDTH = 42;[m
[32m+[m[32m+const EXPANDED_DAY_WIDTH = 72;[m
[32m+[m[32m const WEEK_RANGE_MIN_WIDTH = 150;[m
[32m+[m[41m [m
[32m+[m[32m const getCompactDayLabel = (day: Date): string =>[m
[32m+[m[32m   day.toLocaleDateString("es-ES", { day: "2-digit" });[m
[32m+[m[41m [m
[32m+[m[32m export const ResourceTimeline = ({[m
[32m+[m[32m   tasks,[m
[32m+[m[32m+  employees,[m
[32m+[m[32m   timelineStartDate,[m
[32m+[m[32m   timelineDays = 28,[m
[32m+[m[32m }: ResourceTimelineProps) => {[m
[32m+[m[32m   const [selectedTask, setSelectedTask] = useState<WorkPackage | null>(null);[m
[32m+[m[32m+  const [selectedEmployeeId, setSelectedEmployeeId] = useState<string | null>(null);[m
[32m+[m[32m   const [selectedDepartment, setSelectedDepartment] = useState<string>("Todos");[m
[32m+[m[32m   const [employeeQuery, setEmployeeQuery] = useState<string>("");[m
[32m+[m[32m+  const [expandedWeekKey, setExpandedWeekKey] = useState<string | null>(null);[m
[32m+[m[41m [m
[32m+[m[32m   const departments = useMemo([m
[32m+[m[32m     () => ["Todos", ...new Set(tasks.map((task) => task.department))],[m
[32m+[m[32m     [tasks],[m
[32m+[m[32m   );[m
[32m+[m[41m [m
[32m+[m[32m   const projectLegend = useMemo(() => {[m
[32m+[m[32m     const projects = new Map<[m
[32m+[m[32m       string,[m
[32m+[m[32m       { projectName: string; projectColor: string }[m
[32m+[m[32m     >();[m
[32m+[m[32m     tasks.forEach((task) => {[m
[32m+[m[32m       projects.set(task.projectId, {[m
[32m+[m[32m         projectName: task.projectName,[m
[32m+[m[32m         projectColor: task.projectColor,[m
[32m+[m[32m       });[m
[32m+[m[32m     });[m
[32m+[m[32m     return [...projects.entries()].map(([projectId, data]) => ({[m
[32m+[m[32m       projectId,[m
[32m+[m[32m       ...data,[m
[32m+[m[32m     }));[m
[32m+[m[32m   }, [tasks]);[m
[32m+[m[41m [m
[32m+[m[32m   const filteredTasks = useMemo(() => {[m
[32m+[m[32m     return tasks.filter((task) => {[m
[32m+[m[32m       const matchesDepartment =[m
[32m+[m[32m         selectedDepartment === "Todos" ||[m
[32m+[m[32m         task.department === selectedDepartment;[m
[32m+[m[41m [m
[32m+[m[32m       const matchesSearch =[m
[32m+[m[32m         includesNormalized(task.employeeName, employeeQuery) ||[m
[32m+[m[32m         includesNormalized(task.title, employeeQuery) ||[m
[32m+[m[32m-        includesNormalized(task.description, employeeQuery);[m
[32m+[m[32m+        includesNormalized(task.description, employeeQuery) ||[m
[32m+[m[32m+        includesNormalized(task.projectName, employeeQuery);[m
[32m+[m[41m [m
[32m+[m[32m       return matchesDepartment && matchesSearch;[m
[32m+[m[32m     });[m
[32m+[m[32m   }, [tasks, selectedDepartment, employeeQuery]);[m
[32m+[m[41m [m
[32m+[m[32m   const groupedData = useMemo([m
[32m+[m[32m     () => groupByDepartmentAndEmployee(filteredTasks),[m
[32m+[m[32m     [filteredTasks],[m
[32m+[m[32m   );[m
[32m+[m[41m [m
[32m+[m[32m   const dayRange = useMemo([m
[32m+[m[32m     () => getDayRange(timelineStartDate, timelineDays),[m
[32m+[m[32m     [timelineDays, timelineStartDate],[m
[32m+[m[32m   );[m
[32m+[m[41m [m
[32m+[m[32m   const weekHeaderGroups = useMemo([m
[32m+[m[32m     () => getWeekHeaderGroups(dayRange),[m
[32m+[m[32m     [dayRange],[m
[32m+[m[32m   );[m
[32m+[m[41m [m
[32m+[m[32m+  // Decisi√≥n: modo accordion para KW (solo una semana expandida a la vez).[m
[32m+[m[32m+  const dayWidths = useMemo(() => {[m
[32m+[m[32m+    const weekByDay = dayRange.map((day) => {[m
[32m+[m[32m+      const matchingWeek = weekHeaderGroups.find((group) => day >= group.weekStart && day <= group.weekEnd);[m
[32m+[m[32m+      return matchingWeek?.key;[m
 +    });[m
 +[m
[31m-+    return res.status(200).json(project);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'DELETE') {[m
[31m-+    project.isActive = false;[m
[31m-+    return res.status(200).json(project);[m
[31m-+  }[m
[31m-+[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'PATCH', 'DELETE']);[m
[31m-+}[m
[31m-diff --git a/api/projects/index.js b/api/projects/index.js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..9691077c5d925af414e43e91da259a28e20916e0[m
[31m---- /dev/null[m
[31m-+++ b/api/projects/index.js[m
[31m-@@ -0,0 +1,34 @@[m
[31m-+import { getStore, id } from '../../lib/store.js';[m
[31m-+import { parseBody, sendMethodNotAllowed } from '../../lib/api.js';[m
[31m-+[m
[31m-+const hexColorRegex = /^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/;[m
[31m-+[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(store.projects);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'POST') {[m
[31m-+    const body = parseBody(req);[m
[31m-+    if (!body || typeof body.name !== 'string' || !body.name.trim()) {[m
[31m-+      return res.status(400).json({ error: 'name is required.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    const name = body.name.trim();[m
[31m-+    if (store.projects.some((project) => project.name.toLowerCase() === name.toLowerCase())) {[m
[31m-+      return res.status(409).json({ error: 'Project.name must be unique.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (body.color !== undefined && (typeof body.color !== 'string' || !hexColorRegex.test(body.color))) {[m
[31m-+      return res.status(400).json({ error: 'color must be a valid hex code.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    const project = { id: id('pro', store), name, color: body.color ?? null, isActive: true };[m
[31m-+    store.projects.push(project);[m
[31m-+    return res.status(201).json(project);[m
[31m-+  }[m
[31m-+[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'POST']);[m
[31m-+}[m
[31m-diff --git a/api/task-assignments/[id].js b/api/task-assignments/[id].js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..960ad92ea374c2d1a7df07ab1c803aa996342a5a[m
[31m---- /dev/null[m
[31m-+++ b/api/task-assignments/[id].js[m
[31m-@@ -0,0 +1,46 @@[m
[31m-+import { getStore } from '../../lib/store.js';[m
[31m-+import { isNonNegativeNumber, parseBody, parseId, sendMethodNotAllowed } from '../../lib/api.js';[m
[31m-+[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+  const assignment = store.taskAssignments.find((item) => item.id === parseId(req));[m
[31m-+[m
[31m-+  if (!assignment) {[m
[31m-+    return res.status(404).json({ error: 'TaskAssignment not found.' });[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(assignment);[m
[31m-+  }[m
[32m+[m[32m+    return weekByDay.map((weekKey) => (weekKey && weekKey === expandedWeekKey ? EXPANDED_DAY_WIDTH : DAY_WIDTH));[m
[32m+[m[32m+  }, [dayRange, weekHeaderGroups, expandedWeekKey]);[m
 +[m
[31m-+  if (req.method === 'PATCH') {[m
[31m-+    const body = parseBody(req);[m
[31m-+    if (!body) return res.status(400).json({ error: 'Invalid body.' });[m
[31m-+[m
[31m-+    if (body.allocationHours !== undefined && !isNonNegativeNumber(body.allocationHours)) {[m
[31m-+      return res.status(400).json({ error: 'allocationHours must be >= 0.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    const nextTaskId = body.taskId ?? assignment.taskId;[m
[31m-+    const nextEmployeeId = body.employeeId ?? assignment.employeeId;[m
[31m-+[m
[31m-+    if (store.taskAssignments.some((item) => item.id !== assignment.id && item.taskId === nextTaskId && item.employeeId === nextEmployeeId)) {[m
[31m-+      return res.status(409).json({ error: 'TaskAssignment (taskId, employeeId) must be unique.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    Object.assign(assignment, {[m
[31m-+      ...(body.taskId !== undefined ? { taskId: body.taskId } : {}),[m
[31m-+      ...(body.employeeId !== undefined ? { employeeId: body.employeeId } : {}),[m
[31m-+      ...(body.allocationHours !== undefined ? { allocationHours: body.allocationHours } : {}),[m
[32m+[m[32m+  const cumulativeOffsets = useMemo(() => {[m
[32m+[m[32m+    let acc = 0;[m
[32m+[m[32m+    return dayWidths.map((width) => {[m
[32m+[m[32m+      const left = acc;[m
[32m+[m[32m+      acc += width;[m
[32m+[m[32m+      return left;[m
 +    });[m
[32m+[m[32m+  }, [dayWidths]);[m
 +[m
[31m-+    return res.status(200).json(assignment);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'DELETE') {[m
[31m-+    store.taskAssignments = store.taskAssignments.filter((item) => item.id !== assignment.id);[m
[31m-+    return res.status(204).end();[m
[31m-+  }[m
[31m-+[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'PATCH', 'DELETE']);[m
[31m-+}[m
[31m-diff --git a/api/task-assignments/index.js b/api/task-assignments/index.js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..320625c0119cb695b46f3b07debf87ad7bdad74d[m
[31m---- /dev/null[m
[31m-+++ b/api/task-assignments/index.js[m
[31m-@@ -0,0 +1,40 @@[m
[31m-+import { getStore, id } from '../../lib/store.js';[m
[31m-+import { isNonNegativeNumber, parseBody, sendMethodNotAllowed } from '../../lib/api.js';[m
[31m-+[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(store.taskAssignments);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'POST') {[m
[31m-+    const body = parseBody(req);[m
[31m-+    if (!body || typeof body.taskId !== 'string' || typeof body.employeeId !== 'string') {[m
[31m-+      return res.status(400).json({ error: 'taskId and employeeId are required.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (!store.tasks.some((task) => task.id === body.taskId)) {[m
[31m-+      return res.status(400).json({ error: 'taskId must exist.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (!store.employees.some((employee) => employee.id === body.employeeId)) {[m
[31m-+      return res.status(400).json({ error: 'employeeId must exist.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (!isNonNegativeNumber(body.allocationHours)) {[m
[31m-+      return res.status(400).json({ error: 'allocationHours must be >= 0.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (store.taskAssignments.some((item) => item.taskId === body.taskId && item.employeeId === body.employeeId)) {[m
[31m-+      return res.status(409).json({ error: 'TaskAssignment (taskId, employeeId) must be unique.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    const assignment = { id: id('asg', store), taskId: body.taskId, employeeId: body.employeeId, allocationHours: body.allocationHours };[m
[31m-+    store.taskAssignments.push(assignment);[m
[31m-+[m
[31m-+    return res.status(201).json(assignment);[m
[31m-+  }[m
[32m+[m[32m+  const totalTimelineWidth = useMemo([m
[32m+[m[32m+    () => dayWidths.reduce((sum, width) => sum + width, 0),[m
[32m+[m[32m+    [dayWidths],[m
[32m+[m[32m+  );[m
 +[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'POST']);[m
[32m+[m[32m   const taskTitleById = useMemo(() => {[m
[32m+[m[32m     return new Map(tasks.map((task) => [task.id, task.title]));[m
[32m+[m[32m   }, [tasks]);[m
[32m+[m[41m [m
[32m+[m[32m+  const selectedEmployee = useMemo([m
[32m+[m[32m+    () => employees.find((employee) => employee.employeeId === selectedEmployeeId) ?? null,[m
[32m+[m[32m+    [employees, selectedEmployeeId],[m
[32m+[m[32m+  );[m
[32m+[m[32m+[m
[32m+[m[32m+  const selectedEmployeeTasks = useMemo([m
[32m+[m[32m+    () => tasks.filter((task) => task.employeeId === selectedEmployeeId),[m
[32m+[m[32m+    [tasks, selectedEmployeeId],[m
[32m+[m[32m+  );[m
[32m+[m[32m+[m
[32m+[m[32m   return ([m
[32m+[m[32m     <div className="resource-timeline-page">[m
[32m+[m[32m       <header>[m
[32m+[m[32m         <h1>Vista Recursos (MVP)</h1>[m
[32m+[m[32m         <p>[m
[32m+[m[32m           Visualizaci√≥n por departamento y empleado para saber qui√©n est√°[m
[32m+[m[32m           haciendo qu√© y cu√°ndo.[m
[32m+[m[32m         </p>[m
[32m+[m[32m       </header>[m
[32m+[m[41m [m
[32m+[m[32m       <section className="filters">[m
[32m+[m[32m         <label>[m
[32m+[m[32m           Departamento[m
[32m+[m[32m           <select[m
[32m+[m[32m             value={selectedDepartment}[m
[32m+[m[32m             onChange={(event) => setSelectedDepartment(event.target.value)}[m
[32m+[m[32m           >[m
[32m+[m[32m             {departments.map((department) => ([m
[32m+[m[32m               <option key={department} value={department}>[m
[32m+[m[32m                 {department}[m
[32m+[m[32m               </option>[m
[32m+[m[32m             ))}[m
[32m+[m[32m           </select>[m
[32m+[m[32m         </label>[m
[32m+[m[41m [m
[32m+[m[32m@@ -120,90 +162,110 @@ export const ResourceTimeline = ({[m
[32m+[m[32m             placeholder="Buscar por nombre, tarea o descripci√≥n"[m
[32m+[m[32m             value={employeeQuery}[m
[32m+[m[32m             onChange={(event) => setEmployeeQuery(event.target.value)}[m
[32m+[m[32m           />[m
[32m+[m[32m         </label>[m
[32m+[m[32m       </section>[m
[32m+[m[41m [m
[32m+[m[32m       <section className="project-legend" aria-label="Leyenda de proyectos">[m
[32m+[m[32m         {projectLegend.map((project) => ([m
[32m+[m[32m           <span key={project.projectId} className="legend-item">[m
[32m+[m[32m             <i[m
[32m+[m[32m               style={{ backgroundColor: project.projectColor }}[m
[32m+[m[32m               aria-hidden="true"[m
[32m+[m[32m             />[m
[32m+[m[32m             {project.projectName}[m
[32m+[m[32m           </span>[m
[32m+[m[32m         ))}[m
[32m+[m[32m       </section>[m
[32m+[m[41m [m
[32m+[m[32m       <div className="timeline-shell">[m
[32m+[m[32m         <div className="timeline-header">[m
[32m+[m[32m           <div className="employee-label header">Departamento / Empleado</div>[m
[32m+[m[41m [m
[32m+[m[32m           <div[m
[32m+[m[32m             className="timeline-days"[m
[32m+[m[32m-            style={{ width: DAY_WIDTH * timelineDays }}[m
[32m+[m[32m+            style={{ width: totalTimelineWidth }}[m
[32m+[m[32m           >[m
[32m+[m[32m             <div className="week-header-row">[m
[32m+[m[32m               {weekHeaderGroups.map((weekGroup) => {[m
[32m+[m[32m-                const weekWidth = DAY_WIDTH * weekGroup.visibleDays;[m
[32m+[m[32m+                const weekDays = dayRange.filter([m
[32m+[m[32m+                  (day) => day >= weekGroup.weekStart && day <= weekGroup.weekEnd,[m
[32m+[m[32m+                );[m
[32m+[m[32m+                const weekWidth = weekDays.reduce((sum, day) => {[m
[32m+[m[32m+                  const dayIndex = dayRange.indexOf(day);[m
[32m+[m[32m+                  return sum + dayWidths[dayIndex];[m
[32m+[m[32m+                }, 0);[m
[32m+[m[32m                 const showWeekRange = weekWidth >= WEEK_RANGE_MIN_WIDTH;[m
[32m+[m[32m+                const isActive = expandedWeekKey === weekGroup.key;[m
[32m+[m[41m [m
[32m+[m[32m                 return ([m
[32m+[m[32m-                  <div[m
[32m+[m[32m+                  <button[m
[32m+[m[32m                     key={weekGroup.key}[m
[32m+[m[32m-                    className="week-header"[m
[32m+[m[32m+                    className={`week-header ${isActive ? "week-header--active" : ""}`}[m
[32m+[m[32m                     style={{ width: weekWidth }}[m
[32m+[m[32m+                    type="button"[m
[32m+[m[32m+                    onClick={() => setExpandedWeekKey((current) => (current === weekGroup.key ? null : weekGroup.key))}[m
[32m+[m[32m                   >[m
[32m+[m[32m                     <strong className="week-label">{getWeekLabel(weekGroup.weekStart)}</strong>[m
[32m+[m[32m                     {showWeekRange ? ([m
[32m+[m[32m                       <span className="week-range">[m
[32m+[m[32m                         ({formatDayMonth(weekGroup.weekStart)} -{" "}[m
[32m+[m[32m                         {formatDayMonth(weekGroup.weekEnd)})[m
[32m+[m[32m                       </span>[m
[32m+[m[32m                     ) : null}[m
[32m+[m[32m-                  </div>[m
[32m+[m[32m+                  </button>[m
[32m+[m[32m                 );[m
[32m+[m[32m               })}[m
[32m+[m[32m             </div>[m
[32m+[m[41m [m
[32m+[m[32m             <div className="day-header-row">[m
[32m+[m[32m               {dayRange.map((day, index) => ([m
[32m+[m[32m                 <div[m
[32m+[m[32m                   key={index}[m
[32m+[m[32m                   className="day-header"[m
[32m+[m[32m-                  style={{ width: DAY_WIDTH }}[m
[32m+[m[32m+                  style={{ width: dayWidths[index] }}[m
[32m+[m[32m                 >[m
[32m+[m[32m                   <span className="day-label day-label--default">{formatDayLabel(day)}</span>[m
[32m+[m[32m                   <span className="day-label day-label--compact">{getCompactDayLabel(day)}</span>[m
[32m+[m[32m                 </div>[m
[32m+[m[32m               ))}[m
[32m+[m[32m             </div>[m
[32m+[m[32m           </div>[m
[32m+[m[32m         </div>[m
[32m+[m[41m [m
[32m+[m[32m         {groupedData.length === 0 ? ([m
[32m+[m[32m           <p className="empty-state">No hay tareas con los filtros actuales.</p>[m
[32m+[m[32m         ) : ([m
[32m+[m[32m           groupedData.map((department) => ([m
[32m+[m[32m             <DepartmentSection[m
[32m+[m[32m               key={department.department}[m
[32m+[m[32m               department={department.department}[m
[32m+[m[32m               employees={department.employees}[m
[32m+[m[32m               timelineStartDate={timelineStartDate}[m
[32m+[m[32m               timelineDays={timelineDays}[m
[32m+[m[32m-              dayWidth={DAY_WIDTH}[m
[32m+[m[32m+              dayWidths={dayWidths}[m
[32m+[m[32m+              cumulativeOffsets={cumulativeOffsets}[m
[32m+[m[32m+              totalTimelineWidth={totalTimelineWidth}[m
[32m+[m[32m               onTaskSelect={setSelectedTask}[m
[32m+[m[32m+              onEmployeeSelect={setSelectedEmployeeId}[m
[32m+[m[32m             />[m
[32m+[m[32m           ))[m
[32m+[m[32m         )}[m
[32m+[m[32m       </div>[m
[32m+[m[41m [m
[32m+[m[32m       <TaskDetailsModal[m
[32m+[m[32m         task={selectedTask}[m
[32m+[m[32m         taskTitleById={taskTitleById}[m
[32m+[m[32m         onClose={() => setSelectedTask(null)}[m
[32m+[m[32m       />[m
[32m+[m[32m+[m
[32m+[m[32m+      <EmployeeDetailsModal[m
[32m+[m[32m+        employee={selectedEmployee}[m
[32m+[m[32m+        tasks={selectedEmployeeTasks}[m
[32m+[m[32m+        timelineStartDate={timelineStartDate}[m
[32m+[m[32m+        timelineDays={timelineDays}[m
[32m+[m[32m+        onClose={() => setSelectedEmployeeId(null)}[m
[32m+[m[32m+      />[m
[32m+[m[32m     </div>[m
[32m+[m[32m   );[m
[32m+[m[32m };[m
[32m+[m[32mdiff --git a/src/components/TaskBlock.tsx b/src/components/TaskBlock.tsx[m
[32m+[m[32mindex 58a26cba1d73c998b3f94cebbea6283b2725bb22..67671c5ddfe23d703a0f2070ed13f1a0ed115ce6 100644[m
[32m+[m[32m--- a/src/components/TaskBlock.tsx[m
[32m+[m[32m+++ b/src/components/TaskBlock.tsx[m
[32m+[m[32m@@ -1,33 +1,47 @@[m
[32m+[m[32m import type { WorkPackage } from "../types/workPackage";[m
[32m+[m[32m import { getTaskOffsetDays } from "../utils/timelineUtils";[m
[32m+[m[41m [m
[32m+[m[32m interface TaskBlockProps {[m
[32m+[m[32m   task: WorkPackage;[m
[32m+[m[32m   timelineStartDate: string;[m
[32m+[m[32m   dayWidth: number;[m
[32m+[m[32m+  dayWidths?: number[];[m
[32m+[m[32m+  cumulativeOffsets?: number[];[m
[32m+[m[32m   onSelect: (task: WorkPackage) => void;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m export const TaskBlock = ({[m
[32m+[m[32m   task,[m
[32m+[m[32m   timelineStartDate,[m
[32m+[m[32m   dayWidth,[m
[32m+[m[32m+  dayWidths,[m
[32m+[m[32m+  cumulativeOffsets,[m
[32m+[m[32m   onSelect,[m
[32m+[m[32m }: TaskBlockProps) => {[m
[32m+[m[32m-  const left =[m
[32m+[m[32m-    getTaskOffsetDays(timelineStartDate, task.scheduledStartDate) * dayWidth;[m
[32m+[m[32m-  const width = task.durationDays * dayWidth;[m
[32m+[m[32m+  const startOffset = getTaskOffsetDays(timelineStartDate, task.scheduledStartDate);[m
[32m+[m[32m+  const hasVariableWidths = dayWidths && cumulativeOffsets && dayWidths.length > 0;[m
[32m+[m[32m+[m
[32m+[m[32m+  const left = hasVariableWidths[m
[32m+[m[32m+    ? cumulativeOffsets[Math.max(0, startOffset)] ?? 0[m
[32m+[m[32m+    : startOffset * dayWidth;[m
[32m+[m[32m+[m
[32m+[m[32m+  const width = hasVariableWidths[m
[32m+[m[32m+    ? Array.from({ length: task.durationDays }, (_, index) => dayWidths[startOffset + index] ?? 0).reduce([m
[32m+[m[32m+        (total, current) => total + current,[m
[32m+[m[32m+        0,[m
[32m+[m[32m+      )[m
[32m+[m[32m+    : task.durationDays * dayWidth;[m
[32m+[m[41m [m
[32m+[m[32m   return ([m
[32m+[m[32m     <button[m
[32m+[m[32m       className="task-block"[m
[32m+[m[32m       style={{ left, width, background: task.projectColor }}[m
[32m+[m[32m       onClick={() => onSelect(task)}[m
[32m+[m[32m       title={`${task.title} (${task.projectName})`}[m
[32m+[m[32m       type="button"[m
[32m+[m[32m     >[m
[32m+[m[32m       <span className="task-block-title">{task.title}</span>[m
[32m+[m[32m       <span className="task-block-project">{task.projectName}</span>[m
[32m+[m[32m     </button>[m
[32m+[m[32m   );[m
[32m+[m[32m };[m
[32m+[m[32mdiff --git a/src/data/mock-data.ts b/src/data/mock-data.ts[m
[32m+[m[32mindex 1f66d6dfb06c3cdf4fc01e0408aade60e267c5d1..3ef46603e4c6a122c2c204f04fb5ffd5170449b4 100644[m
[32m+[m[32m--- a/src/data/mock-data.ts[m
[32m+[m[32m+++ b/src/data/mock-data.ts[m
[32m+[m[32m@@ -1,196 +1,189 @@[m
[32m+[m[32m+import { addDays, formatISODate, toDate } from "../utils/dateUtils";[m
[32m+[m[32m import type { WorkPackage } from "../types/workPackage";[m
[32m+[m[41m [m
[32m+[m[32m+export interface EmployeeProfile {[m
[32m+[m[32m+  employeeId: string;[m
[32m+[m[32m+  employeeName: string;[m
[32m+[m[32m+  department: string;[m
[32m+[m[32m+  role: string;[m
[32m+[m[32m+  hourlyCost: number;[m
[32m+[m[32m+  weeklyCapacityHours: number;[m
[32m+[m[32m+  absences: { startDate: string; endDate: string; reason: string }[];[m
 +}[m
[31m-diff --git a/api/tasks/[id].js b/api/tasks/[id].js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..e93c5421266ecb928b6d117935b0fec407a0ee6b[m
[31m---- /dev/null[m
[31m-+++ b/api/tasks/[id].js[m
[31m-@@ -0,0 +1,67 @@[m
[31m-+import { getStore, taskStatuses } from '../../lib/store.js';[m
[31m-+import { isNonNegativeNumber, parseBody, parseId, sendMethodNotAllowed, validateDateRange } from '../../lib/api.js';[m
[31m-+[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+  const task = store.tasks.find((item) => item.id === parseId(req));[m
[31m-+[m
[31m-+  if (!task) {[m
[31m-+    return res.status(404).json({ error: 'Task not found.' });[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(task);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'PATCH') {[m
[31m-+    const body = parseBody(req);[m
[31m-+    if (!body) return res.status(400).json({ error: 'Invalid body.' });[m
[31m-+[m
[31m-+    if (body.projectId !== undefined && !store.projects.some((project) => project.id === body.projectId)) {[m
[31m-+      return res.status(400).json({ error: 'Task.projectId must exist.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (body.departmentId !== undefined && !store.departments.some((department) => department.id === body.departmentId)) {[m
[31m-+      return res.status(400).json({ error: 'Task.departmentId must exist.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (body.estimatedHours !== undefined && !isNonNegativeNumber(body.estimatedHours)) {[m
[31m-+      return res.status(400).json({ error: 'estimatedHours must be >= 0.' });[m
[31m-+    }[m
 +[m
[31m-+    if (body.status !== undefined && !taskStatuses.includes(body.status)) {[m
[31m-+      return res.status(400).json({ error: 'status must be a valid enum value.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    const startDate = body.startDate ?? task.startDate;[m
[31m-+    const endDate = body.endDate ?? task.endDate;[m
[31m-+    const dateCheck = validateDateRange(startDate, endDate);[m
[31m-+    if (!dateCheck.ok) return res.status(400).json({ error: dateCheck.error });[m
[31m-+[m
[31m-+    Object.assign(task, {[m
[31m-+      ...(body.title !== undefined ? { title: body.title.trim() } : {}),[m
[31m-+      ...(body.description !== undefined ? { description: body.description } : {}),[m
[31m-+      ...(body.projectId !== undefined ? { projectId: body.projectId } : {}),[m
[31m-+      ...(body.departmentId !== undefined ? { departmentId: body.departmentId } : {}),[m
[31m-+      ...(body.estimatedHours !== undefined ? { estimatedHours: body.estimatedHours } : {}),[m
[31m-+      ...(body.status !== undefined ? { status: body.status } : {}),[m
[31m-+      ...(body.priority !== undefined ? { priority: body.priority } : {}),[m
[31m-+      ...(typeof body.isActive === 'boolean' ? { isActive: body.isActive } : {}),[m
[31m-+      startDate: dateCheck.start,[m
[31m-+      endDate: dateCheck.end,[m
[32m+[m[32m export const demoStartDate = "2026-02-02";[m
[32m+[m[32m+export const timelineWeeks = 12;[m
[32m+[m[41m [m
[32m+[m[32m export const projectCatalog = {[m
[32m+[m[32m   "P-RHEIN": { name: "Project Rhein", color: "#2563eb" },[m
[32m+[m[32m   "P-ANDEN": { name: "Project Anden", color: "#0f766e" },[m
[32m+[m[32m   "P-AURORA": { name: "Project Aurora", color: "#7c3aed" },[m
[32m+[m[32m   "P-ATLAS": { name: "Project Atlas", color: "#c2410c" },[m
[32m+[m[32m+  "P-DELTA": { name: "Project Delta", color: "#db2777" },[m
[32m+[m[32m+  "P-NOVA": { name: "Project Nova", color: "#0891b2" },[m
[32m+[m[32m } as const;[m
[32m+[m[41m [m
[32m+[m[32m+type ProjectId = keyof typeof projectCatalog;[m
[32m+[m[32m+[m
[32m+[m[32m+const departments = [[m
[32m+[m[32m+  {[m
[32m+[m[32m+    name: "Hardware",[m
[32m+[m[32m+    roles: ["Electronics Engineer", "PCB Designer", "Validation Engineer"],[m
[32m+[m[32m+    employees: [[m
[32m+[m[32m+      "Mar√≠a Rojas",[m
[32m+[m[32m+      "Luis Mendoza",[m
[32m+[m[32m+      "Ana Pardo",[m
[32m+[m[32m+      "Renata Blanco",[m
[32m+[m[32m+      "Iv√°n Cornejo",[m
[32m+[m[32m+    ],[m
[32m+[m[32m+  },[m
[32m+[m[32m+  {[m
[32m+[m[32m+    name: "Software",[m
[32m+[m[32m+    roles: ["Firmware Engineer", "Backend Engineer", "Frontend Engineer"],[m
[32m+[m[32m+    employees: [[m
[32m+[m[32m+      "Diego Le√≥n",[m
[32m+[m[32m+      "Sof√≠a Nieto",[m
[32m+[m[32m+      "Carlos N√∫√±ez",[m
[32m+[m[32m+      "Tom√°s Vera",[m
[32m+[m[32m+      "Elisa C√°rdenas",[m
[32m+[m[32m+    ],[m
[32m+[m[32m+  },[m
[32m+[m[32m+  {[m
[32m+[m[32m+    name: "Producci√≥n",[m
[32m+[m[32m+    roles: ["Process Engineer", "Quality Analyst", "Operations Lead"],[m
[32m+[m[32m+    employees: [[m
[32m+[m[32m+      "Elena Torres",[m
[32m+[m[32m+      "Jorge Vidal",[m
[32m+[m[32m+      "Valeria Sol√≠s",[m
[32m+[m[32m+      "Mart√≠n Cuevas",[m
[32m+[m[32m+      "Nadia Vega",[m
[32m+[m[32m+    ],[m
[32m+[m[32m+  },[m
[32m+[m[32m+  {[m
[32m+[m[32m+    name: "QA",[m
[32m+[m[32m+    roles: ["QA Analyst", "Automation Engineer", "Reliability Engineer"],[m
[32m+[m[32m+    employees: [[m
[32m+[m[32m+      "Gabriela Soto",[m
[32m+[m[32m+      "Leandro Flores",[m
[32m+[m[32m+      "Pilar Reyes",[m
[32m+[m[32m+      "Sebasti√°n Ocampo",[m
[32m+[m[32m+    ],[m
[32m+[m[32m+  },[m
[32m+[m[32m+  {[m
[32m+[m[32m+    name: "Dise√±o",[m
[32m+[m[32m+    roles: ["UX Designer", "UI Designer", "Service Designer"],[m
[32m+[m[32m+    employees: ["Paula Ib√°√±ez", "Nicol√°s Araya", "Milena Torres", "Ra√∫l Pino"],[m
[32m+[m[32m+  },[m
[32m+[m[32m+] as const;[m
[32m+[m[32m+[m
[32m+[m[32m+const taskTopics = [[m
[32m+[m[32m+  "Integraci√≥n m√≥dulo",[m
[32m+[m[32m+  "Refactor de flujo",[m
[32m+[m[32m+  "Plan de validaci√≥n",[m
[32m+[m[32m+  "Dise√±o de interfaz",[m
[32m+[m[32m+  "Pruebas de carga",[m
[32m+[m[32m+  "Ajustes de arquitectura",[m
[32m+[m[32m+  "Automatizaci√≥n de checklist",[m
[32m+[m[32m+  "Optimizaci√≥n de pipeline",[m
[32m+[m[32m+  "Documentaci√≥n operativa",[m
[32m+[m[32m+  "An√°lisis de riesgos",[m
[32m+[m[32m+] as const;[m
[32m+[m[32m+[m
[32m+[m[32m+const taskDescriptions = [[m
[32m+[m[32m+  "Alineaci√≥n con stakeholders y definici√≥n de entregables del sprint.",[m
[32m+[m[32m+  "Implementaci√≥n incremental con foco en estabilidad y mantenibilidad.",[m
[32m+[m[32m+  "Cobertura de casos borde y definici√≥n de criterios de aceptaci√≥n.",[m
[32m+[m[32m+  "Revisi√≥n cruzada entre equipos para minimizar bloqueos de dependencia.",[m
[32m+[m[32m+  "Preparaci√≥n de demo ejecutiva con indicadores de avance.",[m
[32m+[m[32m+] as const;[m
[32m+[m[32m+[m
[32m+[m[32m+const createSeededRandom = (seed: number) => {[m
[32m+[m[32m+  let state = seed;[m
[32m+[m[32m+  return () => {[m
[32m+[m[32m+    state = (state * 1664525 + 1013904223) % 4294967296;[m
[32m+[m[32m+    return state / 4294967296;[m
[32m+[m[32m+  };[m
[32m+[m[32m+};[m
[32m+[m[32m+[m
[32m+[m[32m+const rng = createSeededRandom(24022026);[m
[32m+[m[32m+[m
[32m+[m[32m+const randomInt = (min: number, max: number) =>[m
[32m+[m[32m+  Math.floor(rng() * (max - min + 1)) + min;[m
[32m+[m[32m+[m
[32m+[m[32m+const pickOne = <T,>(items: readonly T[]): T => {[m
[32m+[m[32m+  const index = Math.floor(rng() * items.length);[m
[32m+[m[32m+  return items[index];[m
[32m+[m[32m+};[m
[32m+[m[32m+[m
[32m+[m[32m+const projectIds = Object.keys(projectCatalog) as ProjectId[];[m
[32m+[m[32m+[m
[32m+[m[32m+const buildEmployeeProfiles = (): EmployeeProfile[] => {[m
[32m+[m[32m+  const output: EmployeeProfile[] = [];[m
[32m+[m[32m+[m
[32m+[m[32m+  departments.forEach((department, departmentIndex) => {[m
[32m+[m[32m+    department.employees.forEach((employeeName, employeeIndex) => {[m
[32m+[m[32m+      const employeeId = `EMP-${department.name.slice(0, 2).toUpperCase()}-${String(employeeIndex + 1).padStart(2, "0")}`;[m
[32m+[m[32m+      const weeklyCapacityHours = randomInt(34, 40);[m
[32m+[m[32m+      const absenceStart = addDays(toDate(demoStartDate), randomInt(7, 60));[m
[32m+[m[32m+[m
[32m+[m[32m+      output.push({[m
[32m+[m[32m+        employeeId,[m
[32m+[m[32m+        employeeName,[m
[32m+[m[32m+        department: department.name,[m
[32m+[m[32m+        role: department.roles[(employeeIndex + departmentIndex) % department.roles.length],[m
[32m+[m[32m+        hourlyCost: randomInt(28, 64),[m
[32m+[m[32m+        weeklyCapacityHours,[m
[32m+[m[32m+        absences:[m
[32m+[m[32m+          rng() > 0.45[m
[32m+[m[32m+            ? [[m
[32m+[m[32m+                {[m
[32m+[m[32m+                  startDate: formatISODate(absenceStart),[m
[32m+[m[32m+                  endDate: formatISODate(addDays(absenceStart, randomInt(1, 3))),[m
[32m+[m[32m+                  reason: pickOne(["Vacaciones", "Formaci√≥n", "Permiso"]) as string,[m
[32m+[m[32m+                },[m
[32m+[m[32m+              ][m
[32m+[m[32m+            : [],[m
[32m+[m[32m+      });[m
 +    });[m
[31m-+[m
[31m-+    return res.status(200).json(task);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'DELETE') {[m
[31m-+    if (store.taskAssignments.some((assignment) => assignment.taskId === task.id)) {[m
[31m-+      return res.status(409).json({ error: 'Task cannot be deleted because it has assignments.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    store.tasks = store.tasks.filter((item) => item.id !== task.id);[m
[31m-+    return res.status(204).end();[m
[31m-+  }[m
[31m-+[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'PATCH', 'DELETE']);[m
[31m-+}[m
[31m-diff --git a/api/tasks/index.js b/api/tasks/index.js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..b1ba5cd2bbb87137dfd118e7fd4e0fb8ccdf7357[m
[31m---- /dev/null[m
[31m-+++ b/api/tasks/index.js[m
[31m-@@ -0,0 +1,59 @@[m
[31m-+import { getStore, id, taskStatuses } from '../../lib/store.js';[m
[31m-+import { isNonNegativeNumber, parseBody, sendMethodNotAllowed, validateDateRange } from '../../lib/api.js';[m
[31m-+[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(store.tasks);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'POST') {[m
[31m-+    const body = parseBody(req);[m
[31m-+    if (!body || typeof body.title !== 'string' || !body.title.trim()) {[m
[31m-+      return res.status(400).json({ error: 'title is required.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (!store.projects.some((project) => project.id === body.projectId)) {[m
[31m-+      return res.status(400).json({ error: 'Task.projectId must exist.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (!store.departments.some((department) => department.id === body.departmentId)) {[m
[31m-+      return res.status(400).json({ error: 'Task.departmentId must exist.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    const dateCheck = validateDateRange(body.startDate, body.endDate);[m
[31m-+    if (!dateCheck.ok) return res.status(400).json({ error: dateCheck.error });[m
[31m-+[m
[31m-+    if (!isNonNegativeNumber(body.estimatedHours ?? 0)) {[m
[31m-+      return res.status(400).json({ error: 'estimatedHours must be >= 0.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (body.status !== undefined && !taskStatuses.includes(body.status)) {[m
[31m-+      return res.status(400).json({ error: 'status must be a valid enum value.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (body.priority !== undefined && (!Number.isInteger(body.priority) || body.priority < 1 || body.priority > 5)) {[m
[31m-+      return res.status(400).json({ error: 'priority must be between 1 and 5.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    const task = {[m
[31m-+      id: id('tsk', store),[m
[31m-+      title: body.title.trim(),[m
[31m-+      description: body.description ?? null,[m
[31m-+      projectId: body.projectId,[m
[31m-+      departmentId: body.departmentId,[m
[31m-+      startDate: dateCheck.start,[m
[31m-+      endDate: dateCheck.end,[m
[31m-+      estimatedHours: body.estimatedHours ?? 0,[m
[31m-+      status: body.status ?? 'PLANNED',[m
[31m-+      priority: body.priority ?? null,[m
[31m-+      isActive: true,[m
[31m-+    };[m
[31m-+[m
[31m-+    store.tasks.push(task);[m
[31m-+    return res.status(201).json(task);[m
[31m-+  }[m
[31m-+[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'POST']);[m
[31m-+}[m
[31m-diff --git a/api/time-off/[id].js b/api/time-off/[id].js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..84fcb509837faccf6110544e2c47bc742506c056[m
[31m---- /dev/null[m
[31m-+++ b/api/time-off/[id].js[m
[31m-@@ -0,0 +1,44 @@[m
[31m-+import { getStore, timeOffTypes } from '../../lib/store.js';[m
[31m-+import { parseBody, parseId, sendMethodNotAllowed, validateDateRange } from '../../lib/api.js';[m
[31m-+[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+  const entry = store.timeOff.find((item) => item.id === parseId(req));[m
[31m-+[m
[31m-+  if (!entry) {[m
[31m-+    return res.status(404).json({ error: 'TimeOff not found.' });[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(entry);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'PATCH') {[m
[31m-+    const body = parseBody(req);[m
[31m-+    if (!body) return res.status(400).json({ error: 'Invalid body.' });[m
[31m-+[m
[31m-+    if (body.type !== undefined && !timeOffTypes.includes(body.type)) {[m
[31m-+      return res.status(400).json({ error: 'type must be a valid enum value.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    const dateCheck = validateDateRange(body.startDate ?? entry.startDate, body.endDate ?? entry.endDate);[m
[31m-+    if (!dateCheck.ok) return res.status(400).json({ error: dateCheck.error });[m
[31m-+[m
[31m-+    Object.assign(entry, {[m
[31m-+      ...(body.employeeId !== undefined ? { employeeId: body.employeeId } : {}),[m
[31m-+      ...(body.type !== undefined ? { type: body.type } : {}),[m
[31m-+      ...(body.notes !== undefined ? { notes: body.notes } : {}),[m
[31m-+      startDate: dateCheck.start,[m
[31m-+      endDate: dateCheck.end,[m
[32m+[m[32m+  });[m
[32m+[m[32m+[m
[32m+[m[32m+  return output;[m
[32m+[m[32m+};[m
[32m+[m[32m+[m
[32m+[m[32m+export const employeeProfiles = buildEmployeeProfiles();[m
[32m+[m[32m+[m
[32m+[m[32m const withProject = ([m
[32m+[m[32m-  projectId: keyof typeof projectCatalog,[m
[32m+[m[32m+  projectId: ProjectId,[m
[32m+[m[32m   task: Omit<WorkPackage, "projectId" | "projectName" | "projectColor">,[m
[32m+[m[32m ): WorkPackage => ({[m
[32m+[m[32m   ...task,[m
[32m+[m[32m   projectId,[m
[32m+[m[32m   projectName: projectCatalog[projectId].name,[m
[32m+[m[32m   projectColor: projectCatalog[projectId].color,[m
[32m+[m[32m });[m
[32m+[m[41m [m
[32m+[m[32m-export const workPackages: WorkPackage[] = [[m
[32m+[m[32m-  withProject("P-RHEIN", {[m
[32m+[m[32m-    id: "HW-101",[m
[32m+[m[32m-    department: "Hardware",[m
[32m+[m[32m-    employeeId: "EMP-HW-01",[m
[32m+[m[32m-    employeeName: "Mar√≠a Rojas",[m
[32m+[m[32m-    title: "Dise√±o de fuente conmutada",[m
[32m+[m[32m-    description: "Topolog√≠a inicial y validaci√≥n de componentes cr√≠ticos.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-02",[m
[32m+[m[32m-    deadlineDate: "2026-02-11",[m
[32m+[m[32m-    durationDays: 4,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-02",[m
[32m+[m[32m-    dependencies: [],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-  withProject("P-ANDEN", {[m
[32m+[m[32m-    id: "HW-102",[m
[32m+[m[32m-    department: "Hardware",[m
[32m+[m[32m-    employeeId: "EMP-HW-02",[m
[32m+[m[32m-    employeeName: "Luis Mendoza",[m
[32m+[m[32m-    title: "Selecci√≥n de sensores IMU",[m
[32m+[m[32m-    description: "Comparativa de ruido, consumo y disponibilidad de mercado.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-03",[m
[32m+[m[32m-    deadlineDate: "2026-02-12",[m
[32m+[m[32m-    durationDays: 3,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-04",[m
[32m+[m[32m-    dependencies: [],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-  withProject("P-AURORA", {[m
[32m+[m[32m-    id: "HW-103",[m
[32m+[m[32m-    department: "Hardware",[m
[32m+[m[32m-    employeeId: "EMP-HW-03",[m
[32m+[m[32m-    employeeName: "Ana Pardo",[m
[32m+[m[32m-    title: "Pre-check EMC de prototipo",[m
[32m+[m[32m-    description:[m
[32m+[m[32m-      "Barrido preliminar de emisiones antes de laboratorio externo.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-10",[m
[32m+[m[32m-    deadlineDate: "2026-02-20",[m
[32m+[m[32m-    durationDays: 4,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-12",[m
[32m+[m[32m-    dependencies: [{ type: "FS", taskId: "HW-101" }],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-  withProject("P-ATLAS", {[m
[32m+[m[32m-    id: "HW-104",[m
[32m+[m[32m-    department: "Hardware",[m
[32m+[m[32m-    employeeId: "EMP-HW-01",[m
[32m+[m[32m-    employeeName: "Mar√≠a Rojas",[m
[32m+[m[32m-    title: "Revisi√≥n DFM PCB",[m
[32m+[m[32m-    description: "Ajustes de manufactura para lotes piloto y panelizado.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-15",[m
[32m+[m[32m-    deadlineDate: "2026-02-27",[m
[32m+[m[32m-    durationDays: 4,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-18",[m
[32m+[m[32m-    dependencies: [{ type: "SS", taskId: "HW-103" }],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-[m
[32m+[m[32m-  withProject("P-RHEIN", {[m
[32m+[m[32m-    id: "SW-201",[m
[32m+[m[32m-    department: "Software",[m
[32m+[m[32m-    employeeId: "EMP-SW-01",[m
[32m+[m[32m-    employeeName: "Diego Le√≥n",[m
[32m+[m[32m-    title: "Arquitectura de firmware base",[m
[32m+[m[32m-    description: "Definici√≥n de capas HAL, drivers y servicios.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-02",[m
[32m+[m[32m-    deadlineDate: "2026-02-10",[m
[32m+[m[32m-    durationDays: 4,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-03",[m
[32m+[m[32m-    dependencies: [],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-  withProject("P-RHEIN", {[m
[32m+[m[32m-    id: "SW-202",[m
[32m+[m[32m-    department: "Software",[m
[32m+[m[32m-    employeeId: "EMP-SW-01",[m
[32m+[m[32m-    employeeName: "Diego Le√≥n",[m
[32m+[m[32m-    title: "Drivers UART/I2C",[m
[32m+[m[32m-    description: "Implementaci√≥n y pruebas unitarias de comunicaci√≥n serial.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-08",[m
[32m+[m[32m-    deadlineDate: "2026-02-18",[m
[32m+[m[32m-    durationDays: 5,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-09",[m
[32m+[m[32m-    dependencies: [{ type: "FS", taskId: "SW-201" }],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-  withProject("P-ANDEN", {[m
[32m+[m[32m-    id: "SW-203",[m
[32m+[m[32m-    department: "Software",[m
[32m+[m[32m-    employeeId: "EMP-SW-02",[m
[32m+[m[32m-    employeeName: "Sofia Nieto",[m
[32m+[m[32m-    title: "API de telemetr√≠a",[m
[32m+[m[32m-    description: "Contrato JSON para eventos y m√©tricas de sensores.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-05",[m
[32m+[m[32m-    deadlineDate: "2026-02-16",[m
[32m+[m[32m-    durationDays: 4,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-06",[m
[32m+[m[32m-    dependencies: [],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-  withProject("P-AURORA", {[m
[32m+[m[32m-    id: "SW-204",[m
[32m+[m[32m-    department: "Software",[m
[32m+[m[32m-    employeeId: "EMP-SW-02",[m
[32m+[m[32m-    employeeName: "S√≥fia Nieto",[m
[32m+[m[32m-    title: "Autenticaci√≥n de dispositivos",[m
[32m+[m[32m-    description: "Flujo de enrolamiento con refresh tokens y expiraci√≥n.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-13",[m
[32m+[m[32m-    deadlineDate: "2026-02-23",[m
[32m+[m[32m-    durationDays: 4,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-14",[m
[32m+[m[32m-    dependencies: [{ type: "FS", taskId: "SW-203" }],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-  withProject("P-ATLAS", {[m
[32m+[m[32m-    id: "SW-205",[m
[32m+[m[32m-    department: "Software",[m
[32m+[m[32m-    employeeId: "EMP-SW-03",[m
[32m+[m[32m-    employeeName: "Carlos N√∫√±ez",[m
[32m+[m[32m-    title: "Dashboard de diagn√≥stico",[m
[32m+[m[32m-    description: "Panel web para estado en vivo de nodos remotos.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-16",[m
[32m+[m[32m-    deadlineDate: "2026-02-27",[m
[32m+[m[32m-    durationDays: 5,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-17",[m
[32m+[m[32m-    dependencies: [{ type: "SS", taskId: "SW-202" }],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-[m
[32m+[m[32m-  withProject("P-RHEIN", {[m
[32m+[m[32m-    id: "PR-301",[m
[32m+[m[32m-    department: "Producci√≥n",[m
[32m+[m[32m-    employeeId: "EMP-PR-01",[m
[32m+[m[32m-    employeeName: "Elena Torres",[m
[32m+[m[32m-    title: "Plan de montaje piloto",[m
[32m+[m[32m-    description: "Secuencia de estaciones y criterios de aceptaci√≥n.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-07",[m
[32m+[m[32m-    deadlineDate: "2026-02-17",[m
[32m+[m[32m-    durationDays: 4,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-08",[m
[32m+[m[32m-    dependencies: [{ type: "FS", taskId: "HW-101" }],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-  withProject("P-ANDEN", {[m
[32m+[m[32m-    id: "PR-302",[m
[32m+[m[32m-    department: "Producci√≥n",[m
[32m+[m[32m-    employeeId: "EMP-PR-02",[m
[32m+[m[32m-    employeeName: "Jorge Vidal",[m
[32m+[m[32m-    title: "Balanceo de l√≠nea inicial",[m
[32m+[m[32m-    description:[m
[32m+[m[32m-      "Distribuci√≥n de carga por estaci√≥n para reducir cuellos de botella.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-12",[m
[32m+[m[32m-    deadlineDate: "2026-02-22",[m
[32m+[m[32m-    durationDays: 4,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-13",[m
[32m+[m[32m-    dependencies: [{ type: "FS", taskId: "PR-301" }],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-  withProject("P-AURORA", {[m
[32m+[m[32m-    id: "PR-303",[m
[32m+[m[32m-    department: "Producci√≥n",[m
[32m+[m[32m-    employeeId: "EMP-PR-03",[m
[32m+[m[32m-    employeeName: "Valeria Sol√≠s",[m
[32m+[m[32m-    title: "Checklist de calidad inicial",[m
[32m+[m[32m-    description: "Control visual, el√©ctrico y trazabilidad de lote.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-10",[m
[32m+[m[32m-    deadlineDate: "2026-02-18",[m
[32m+[m[32m-    durationDays: 3,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-10",[m
[32m+[m[32m-    dependencies: [],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-  withProject("P-ATLAS", {[m
[32m+[m[32m-    id: "PR-304",[m
[32m+[m[32m-    department: "Producci√≥n",[m
[32m+[m[32m-    employeeId: "EMP-PR-03",[m
[32m+[m[32m-    employeeName: "Valeria Sol√≠s",[m
[32m+[m[32m-    title: "Corrida piloto de empaque",[m
[32m+[m[32m-    description: "Validaci√≥n de etiquetas multi-idioma y cajas master.",[m
[32m+[m[32m-    earliestStartDate: "2026-02-19",[m
[32m+[m[32m-    deadlineDate: "2026-03-01",[m
[32m+[m[32m-    durationDays: 4,[m
[32m+[m[32m-    scheduledStartDate: "2026-02-20",[m
[32m+[m[32m-    dependencies: [{ type: "FS", taskId: "PR-303" }],[m
[32m+[m[32m-  }),[m
[32m+[m[32m-];[m
[32m+[m[32m+export const workPackages: WorkPackage[] = employeeProfiles.flatMap((employee, employeeIndex) => {[m
[32m+[m[32m+  const taskCount = randomInt(4, 8);[m
[32m+[m[32m+[m
[32m+[m[32m+  return Array.from({ length: taskCount }, (_, taskIndex) => {[m
[32m+[m[32m+    const projectId = pickOne(projectIds);[m
[32m+[m[32m+    const startOffset = randomInt(0, timelineWeeks * 7 - 14);[m
[32m+[m[32m+    const durationDays = randomInt(2, 6);[m
[32m+[m[32m+    const startDate = addDays(toDate(demoStartDate), startOffset);[m
[32m+[m[32m+    const dependencyTaskId = taskIndex > 0 ? `${employee.employeeId}-TSK-${taskIndex}` : null;[m
[32m+[m[32m+[m
[32m+[m[32m+    return withProject(projectId, {[m
[32m+[m[32m+      id: `${employee.employeeId}-TSK-${taskIndex + 1}`,[m
[32m+[m[32m+      department: employee.department,[m
[32m+[m[32m+      employeeId: employee.employeeId,[m
[32m+[m[32m+      employeeName: employee.employeeName,[m
[32m+[m[32m+      title: `${pickOne(taskTopics)} ${taskIndex + 1}`,[m
[32m+[m[32m+      description: `${pickOne(taskDescriptions)} Equipo: ${employee.department}.`,[m
[32m+[m[32m+      earliestStartDate: formatISODate(addDays(startDate, -randomInt(0, 2))),[m
[32m+[m[32m+      deadlineDate: formatISODate(addDays(startDate, durationDays + randomInt(2, 6))),[m
[32m+[m[32m+      durationDays,[m
[32m+[m[32m+      scheduledStartDate: formatISODate(startDate),[m
[32m+[m[32m+      dependencies: dependencyTaskId ? [{ type: pickOne(["FS", "SS"]), taskId: dependencyTaskId }] : [],[m
 +    });[m
[31m-+[m
[31m-+    return res.status(200).json(entry);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'DELETE') {[m
[31m-+    store.timeOff = store.timeOff.filter((item) => item.id !== entry.id);[m
[31m-+    return res.status(204).end();[m
[31m-+  }[m
[31m-+[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'PATCH', 'DELETE']);[m
[31m-+}[m
[31m-diff --git a/api/time-off/index.js b/api/time-off/index.js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..d4f38419a653e83d59a8e565c2be347078d1b542[m
[31m---- /dev/null[m
[31m-+++ b/api/time-off/index.js[m
[31m-@@ -0,0 +1,43 @@[m
[31m-+import { getStore, id, timeOffTypes } from '../../lib/store.js';[m
[31m-+import { parseBody, sendMethodNotAllowed, validateDateRange } from '../../lib/api.js';[m
[31m-+[m
[31m-+export default async function handler(req, res) {[m
[31m-+  const store = getStore();[m
[31m-+[m
[31m-+  if (req.method === 'GET') {[m
[31m-+    return res.status(200).json(store.timeOff);[m
[31m-+  }[m
[31m-+[m
[31m-+  if (req.method === 'POST') {[m
[31m-+    const body = parseBody(req);[m
[31m-+[m
[31m-+    if (!body || typeof body.employeeId !== 'string') {[m
[31m-+      return res.status(400).json({ error: 'employeeId is required.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (!store.employees.some((employee) => employee.id === body.employeeId)) {[m
[31m-+      return res.status(400).json({ error: 'employeeId must exist.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    if (!timeOffTypes.includes(body.type)) {[m
[31m-+      return res.status(400).json({ error: 'type must be a valid enum value.' });[m
[31m-+    }[m
[31m-+[m
[31m-+    const dateCheck = validateDateRange(body.startDate, body.endDate);[m
[31m-+    if (!dateCheck.ok) return res.status(400).json({ error: dateCheck.error });[m
[31m-+[m
[31m-+    const entry = {[m
[31m-+      id: id('to', store),[m
[31m-+      employeeId: body.employeeId,[m
[31m-+      startDate: dateCheck.start,[m
[31m-+      endDate: dateCheck.end,[m
[31m-+      type: body.type,[m
[31m-+      notes: body.notes ?? null,[m
[31m-+    };[m
[31m-+    store.timeOff.push(entry);[m
[31m-+[m
[31m-+    return res.status(201).json(entry);[m
[31m-+  }[m
[31m-+[m
[31m-+  return sendMethodNotAllowed(res, ['GET', 'POST']);[m
[31m-+}[m
[31m-diff --git a/lib/api.js b/lib/api.js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..a9688f3533df54241b2a7f8e3eb2f3c81b0d4860[m
[31m---- /dev/null[m
[31m-+++ b/lib/api.js[m
[31m-@@ -0,0 +1,42 @@[m
[31m-+export function sendMethodNotAllowed(res, allowedMethods) {[m
[31m-+  res.setHeader('Allow', allowedMethods);[m
[31m-+  return res.status(405).json({ error: `Method not allowed. Use: ${allowedMethods.join(', ')}` });[m
[31m-+}[m
[31m-+[m
[31m-+export function parseId(req) {[m
[31m-+  return req.query.id;[m
[31m-+}[m
[31m-+[m
[31m-+export function parseBody(req) {[m
[31m-+  if (typeof req.body === 'string') {[m
[31m-+    try {[m
[31m-+      return JSON.parse(req.body);[m
[31m-+    } catch {[m
[31m-+      return null;[m
[31m-+    }[m
[31m-+  }[m
[31m-+  return req.body;[m
[31m-+}[m
[31m-+[m
[31m-+export function isNonNegativeNumber(value) {[m
[31m-+  return typeof value === 'number' && Number.isFinite(value) && value >= 0;[m
[31m-+}[m
[31m-+[m
[31m-+export function validateDateRange(startDate, endDate) {[m
[31m-+  const start = new Date(startDate);[m
[31m-+  const end = new Date(endDate);[m
[31m-+[m
[31m-+  if (Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {[m
[31m-+    return { ok: false, error: 'startDate and endDate must be valid ISO dates.' };[m
[31m-+  }[m
[31m-+[m
[31m-+  if (end < start) {[m
[31m-+    return { ok: false, error: 'endDate must be greater than or equal to startDate.' };[m
[31m-+  }[m
[31m-+[m
[31m-+  return { ok: true, start: start.toISOString().slice(0, 10), end: end.toISOString().slice(0, 10) };[m
[31m-+}[m
[31m-+[m
[31m-+export function conflict(res, message) {[m
[31m-+  return res.status(409).json({ error: message });[m
[31m-+}[m
[31m-diff --git a/lib/store.js b/lib/store.js[m
[31m-new file mode 100644[m
[31m-index 0000000000000000000000000000000000000000..49258110a44c6bafb0bae6b8a76c4e3c321a1073[m
[31m---- /dev/null[m
[31m-+++ b/lib/store.js[m
[31m-@@ -0,0 +1,62 @@[m
[31m-+const taskStatuses = ['PLANNED', 'IN_PROGRESS', 'DONE', 'BLOCKED'];[m
[31m-+const timeOffTypes = ['VACATION', 'SICK', 'OTHER'];[m
[31m-+[m
[31m-+function createSeed() {[m
[31m-+  const departments = [[m
[31m-+    { id: 'dep_eng', name: 'Engineering', isActive: true },[m
[31m-+    { id: 'dep_des', name: 'Design', isActive: true },[m
[31m-+  ];[m
[31m-+[m
[31m-+  const employees = [[m
[31m-+    { id: 'emp_alice', fullName: 'Alice Rivera', departmentId: 'dep_eng', capacityHoursPerWeek: 40, costPerHour: 65, isActive: true },[m
[31m-+    { id: 'emp_bob', fullName: 'Bob Mart√≠n', departmentId: 'dep_eng', capacityHoursPerWeek: 35, costPerHour: null, isActive: true },[m
[31m-+    { id: 'emp_carla', fullName: 'Carla Soto', departmentId: 'dep_des', capacityHoursPerWeek: 40, costPerHour: null, isActive: true },[m
[31m-+  ];[m
[31m-+[m
[31m-+  const projects = [{ id: 'pro_web', name: 'Website Revamp', color: '#3B82F6', isActive: true }];[m
[31m-+[m
[31m-+  const tasks = [{[m
[31m-+    id: 'tsk_onboarding',[m
[31m-+    title: 'Implement onboarding flow',[m
[31m-+    description: 'Crear onboarding inicial para usuarios nuevos.',[m
[31m-+    projectId: 'pro_web',[m
[31m-+    departmentId: 'dep_eng',[m
[31m-+    startDate: '2026-02-16',[m
[31m-+    endDate: '2026-02-27',[m
[31m-+    estimatedHours: 80,[m
[31m-+    status: 'IN_PROGRESS',[m
[31m-+    priority: 2,[m
[31m-+    isActive: true,[m
[31m-+  }];[m
[31m-+[m
[31m-+  const taskAssignments = [[m
[31m-+    { id: 'asg_alice_onboarding', taskId: 'tsk_onboarding', employeeId: 'emp_alice', allocationHours: 30 },[m
[31m-+    { id: 'asg_bob_onboarding', taskId: 'tsk_onboarding', employeeId: 'emp_bob', allocationHours: 20 },[m
[31m-+  ];[m
[31m-+[m
[31m-+  const timeOff = [{[m
[31m-+    id: 'to_carla_1',[m
[31m-+    employeeId: 'emp_carla',[m
[31m-+    startDate: '2026-02-24',[m
[31m-+    endDate: '2026-02-26',[m
[31m-+    type: 'VACATION',[m
[31m-+    notes: 'Vacaciones planificadas',[m
[31m-+  }];[m
[31m-+[m
[31m-+  return { departments, employees, projects, tasks, taskAssignments, timeOff, nextId: 1 };[m
[32m+[m[32m+  });[m
[32m+[m[32m+});[m
[32m+[m[32mdiff --git a/src/styles.css b/src/styles.css[m
[32m+[m[32mindex 88a8d2b2da1ee9c616003b59fa8695382204f0f8..892f78fc9a052fd13f67135779f30098e325bbcb 100644[m
[32m+[m[32m--- a/src/styles.css[m
[32m+[m[32m+++ b/src/styles.css[m
[32m+[m[32m@@ -71,155 +71,178 @@ header p {[m
[32m+[m[32m   font-size: 0.88rem;[m
[32m+[m[32m   color: #334155;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .legend-item i,[m
[32m+[m[32m .project-chip i {[m
[32m+[m[32m   width: 12px;[m
[32m+[m[32m   height: 12px;[m
[32m+[m[32m   border-radius: 50%;[m
[32m+[m[32m   display: inline-block;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .timeline-shell {[m
[32m+[m[32m   background: #fff;[m
[32m+[m[32m   border: 1px solid #e2e8f0;[m
[32m+[m[32m   border-radius: 12px;[m
[32m+[m[32m   overflow: auto;[m
[32m+[m[32m   max-height: calc(100vh - 260px);[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .timeline-header {[m
[32m+[m[32m   display: inline-flex;[m
[32m+[m[32m   min-width: max-content;[m
[32m+[m[32m   position: sticky;[m
[32m+[m[32m   top: 0;[m
[32m+[m[32m-  z-index: 4;[m
[32m+[m[32m+  z-index: 8;[m
[32m+[m[32m   background: #f1f5f9;[m
[32m+[m[32m   border-bottom: 1px solid #cbd5e1;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .timeline-days {[m
[32m+[m[32m   display: flex;[m
[32m+[m[32m   flex-direction: column;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .week-header-row,[m
[32m+[m[32m .day-header-row {[m
[32m+[m[32m   display: flex;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .week-header {[m
[32m+[m[32m+  border: 0;[m
[32m+[m[32m   border-left: 1px solid #cbd5e1;[m
[32m+[m[32m   padding: 0.35rem 0.25rem;[m
[32m+[m[32m   min-height: var(--timeline-header-week-height);[m
[32m+[m[32m   font-size: 0.7rem;[m
[32m+[m[32m   display: flex;[m
[32m+[m[32m   gap: 0.25rem;[m
[32m+[m[32m   align-items: center;[m
[32m+[m[32m   min-width: 0;[m
[32m+[m[32m   overflow: hidden;[m
[32m+[m[32m+  cursor: pointer;[m
[32m+[m[32m+  background: #e2e8f0;[m
[32m+[m[32m+  text-align: left;[m
 +}[m
 +[m
[31m-+function id(prefix, state) {[m
[31m-+  const value = `${prefix}_${state.nextId}`;[m
[31m-+  state.nextId += 1;[m
[31m-+  return value;[m
[32m+[m[32m+.week-header--active {[m
[32m+[m[32m+  background: #cbd5e1;[m
[32m+[m[32m+  outline: 2px solid #3b82f6;[m
[32m+[m[32m+  outline-offset: -2px;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .week-label,[m
[32m+[m[32m .week-range {[m
[32m+[m[32m   display: block;[m
[32m+[m[32m   min-width: 0;[m
[32m+[m[32m   overflow: hidden;[m
[32m+[m[32m   text-overflow: ellipsis;[m
[32m+[m[32m   white-space: nowrap;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .week-header strong {[m
[32m+[m[32m   font-size: 0.72rem;[m
[32m+[m[32m   flex: 0 1 auto;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .week-range {[m
[32m+[m[32m   flex: 1 1 auto;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .day-header {[m
[32m+[m[32m   border-left: 1px solid #cbd5e1;[m
[32m+[m[32m   padding: 0.35rem 0.2rem;[m
[32m+[m[32m   font-size: 0.7rem;[m
[32m+[m[32m   min-height: var(--timeline-header-day-height);[m
[32m+[m[32m   display: flex;[m
[32m+[m[32m   justify-content: center;[m
[32m+[m[32m   min-width: 0;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .day-label {[m
[32m+[m[32m   display: none;[m
[32m+[m[32m   width: 100%;[m
[32m+[m[32m   white-space: nowrap;[m
[32m+[m[32m   overflow: hidden;[m
[32m+[m[32m   text-overflow: ellipsis;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .day-label--default {[m
[32m+[m[32m   display: block;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m-.day-header strong {[m
[32m+[m[32m-  font-size: 0.72rem;[m
[32m+[m[32m-}[m
[32m+[m[32m-[m
[32m+[m[32m .employee-label {[m
[32m+[m[32m   min-width: 220px;[m
[32m+[m[32m   border-right: 1px solid #cbd5e1;[m
[32m+[m[32m+  border-bottom: 1px solid #f1f5f9;[m
[32m+[m[32m   padding: 0.65rem;[m
[32m+[m[32m   display: flex;[m
[32m+[m[32m   align-items: center;[m
[32m+[m[32m   justify-content: flex-start;[m
[32m+[m[32m   background: #fcfdff;[m
[32m+[m[32m-[m
[32m+[m[32m+  position: sticky;[m
[32m+[m[32m+  left: 0;[m
[32m+[m[32m+  z-index: 6;[m
[32m+[m[32m   min-height: var(--timeline-row-height);[m
[32m+[m[32m   margin: 0;[m
[32m+[m[32m   line-height: 1.2;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m+.employee-button {[m
[32m+[m[32m+  width: 220px;[m
[32m+[m[32m+  border-top: 0;[m
[32m+[m[32m+  border-left: 0;[m
[32m+[m[32m+  border-right: 1px solid #cbd5e1;[m
[32m+[m[32m+  border-bottom: 1px solid #f1f5f9;[m
[32m+[m[32m+  cursor: pointer;[m
[32m+[m[32m+  font-weight: 600;[m
 +}[m
 +[m
[31m-+export function getStore() {[m
[31m-+  if (!globalThis.__resourceStore) {[m
[31m-+    globalThis.__resourceStore = createSeed();[m
[32m+[m[32m .employee-label.header {[m
[32m+[m[32m   font-size: 0.8rem;[m
[32m+[m[32m   font-weight: 700;[m
[32m+[m[32m   text-transform: uppercase;[m
[32m+[m[32m+  z-index: 9;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .employee-row {[m
[32m+[m[32m   display: flex;[m
[32m+[m[32m   align-items: stretch;[m
[32m+[m[32m   min-height: var(--timeline-row-height);[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .employee-timeline {[m
[32m+[m[32m   display: flex;[m
[32m+[m[32m   position: relative;[m
[32m+[m[32m   min-height: var(--timeline-row-height);[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .day-cell {[m
[32m+[m[32m   border-left: 1px solid #f1f5f9;[m
[32m+[m[32m+  position: absolute;[m
[32m+[m[32m+  top: 0;[m
[32m+[m[32m+  bottom: 0;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .task-block {[m
[32m+[m[32m   position: absolute;[m
[32m+[m[32m   top: 8px;[m
[32m+[m[32m   bottom: 8px;[m
[32m+[m[32m   border: 0;[m
[32m+[m[32m   border-radius: 8px;[m
[32m+[m[32m   color: #fff;[m
[32m+[m[32m   display: flex;[m
[32m+[m[32m   flex-direction: column;[m
[32m+[m[32m   align-items: flex-start;[m
[32m+[m[32m   justify-content: center;[m
[32m+[m[32m   padding: 0.2rem 0.4rem;[m
[32m+[m[32m   cursor: pointer;[m
[32m+[m[32m   text-align: left;[m
[32m+[m[32m   overflow: hidden;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m .task-block-title {[m
[32m+[m[32m   font-size: 0.72rem;[m
[32m+[m[32m   font-weight: 700;[m
[32m+[m[32m   white-space: nowrap;[m
[32m+[m[32m   overflow: hidden;[m
[32m+[m[32m   text-overflow: ellipsis;[m
[32m+[m[32m@@ -293,34 +316,40 @@ header p {[m
[32m+[m[32m .deadline {[m
[32m+[m[32m   color: #dc2626;[m
[32m+[m[32m }[m
[32m+[m[41m [m
[32m+[m[32m @media (max-width: 768px) {[m
[32m+[m[32m   .resource-timeline-page {[m
[32m+[m[32m     padding: 0.8rem;[m
[32m+[m[32m   }[m
[32m+[m[41m [m
[32m+[m[32m   .timeline-shell {[m
[32m+[m[32m     max-height: calc(100vh - 220px);[m
[32m+[m[32m   }[m
[32m+[m[41m [m
[32m+[m[32m   .week-header {[m
[32m+[m[32m     gap: 0.15rem;[m
[32m+[m[32m   }[m
[32m+[m[41m [m
[32m+[m[32m   .day-label--default {[m
[32m+[m[32m     display: none;[m
[32m+[m[32m   }[m
[32m+[m[41m [m
[32m+[m[32m   .day-label--compact {[m
[32m+[m[32m     display: block;[m
[32m+[m[32m   }[m
[32m+[m[41m [m
[32m+[m[32m+  .employee-label,[m
[32m+[m[32m+  .employee-button {[m
[32m+[m[32m+    min-width: 160px;[m
[32m+[m[32m+    width: 160px;[m
 +  }[m
[31m-+  return globalThis.__resourceStore;[m
[31m-+}[m
 +[m
[31m-+export { id, taskStatuses, timeOffTypes };[m
[32m+[m[32m   .modal-panel {[m
[32m+[m[32m     width: 100vw;[m
[32m+[m[32m   }[m
[32m+[m[41m [m
[32m+[m[32m   .modal-panel dl {[m
[32m+[m[32m     grid-template-columns: 1fr;[m
[32m+[m[32m     gap: 0.25rem;[m
[32m+[m[32m   }[m
[32m+[m[32m }[m
[41m+[m
